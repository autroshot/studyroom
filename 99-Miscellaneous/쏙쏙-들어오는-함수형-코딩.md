# 쏙쏙 들어오는 함수형 코딩

함수형 프로그래밍은 부수 효과를 구성하는 방법에 대한 내용이다. 부수 효과를 잘 관리해서 코드의 아무 곳에나 있지 않게 한다.

## 1. 쏙쏙 들어오는 함수형 코딩에 오신 것을 환영합니다

부수 효과 없이 순수 함수만 사용하는 프로그래밍이다.

부수 효과(side effect)는 함수가 반환값 이외에 하는 모든 일을 말한다. 메일 보내기, 파일 읽기, 웹 요청하기, 전역 상태 수정하기가 모두 여기에 포함된다.

순수 함수(pure function)는 부수 효과가 없는 함수이다. 같은 인자를 넣으면 항상 같은 결과를 반환한다. 수학 함수로도 불린다. 순수 함수는 다루기 쉽고 이해하기 쉽다.

실제 프로그래머가 순수 함수만 사용하는 것은 불가능하다. 부수 효과는 소프트웨어를 실행하는 이유이다.

이 책에서는 학문적인 함수형 프로그래밍이 아닌 실제 개발에 적용되는 함수형 프로그래밍을 다룬다.

**액션보다 계산이 쉽고 계산보다 데이터가 쉽다.**

|        | 설명                                                         | 동의어                                    | 예                                                     |
| ------ | ------------------------------------------------------------ | ----------------------------------------- | ------------------------------------------------------ |
| 액션   | 실행 시점(순서)이나 횟수에 의존한다.                         | 부수 효과가 있는 함수, 순수하지 않은 함수 | 이메일 보내기, 데이터베이스 읽기                       |
| 계산   | 입력값으로 출력값을 만드는 것이다. 같은 입력을 계산하면 항상 같은 결과가 나온다. 외부와 상호 작용하지 않는다. | 순수 함수, 수학 함수                      | 최댓값 찾기, 이메일 주소가 올바른지 확인하기           |
| 데이터 | 데이터는 알아보기 쉽고 그 자체로 의미를 가진다.              |                                           | 사용자가 입력한 이메일 주소, 은행 API로 읽은 달러 수량 |

분산 시스템이 어려운 이유는 다음과 같다.

- 메시지 순서가 바뀔 수 있다.
- 메시지는 한 번 이상 도착하거나 도착하지 않을 수도 있다.
- 응답을 받지 못하면 무슨 일이 생겼는지 알 수 없다.

함수형 프로그래밍을 사용하면 분산 시스템 사용이 쉬워진다.

함수형 사고는 함수형 프로그래머가 소프트웨어 문제를 해결하기 위해 사용하는 기술과 생각이다. 함수형 프로그래밍에서 가장 중요한 개념은 다음 두 가지다.

1. 액션, 계산, 데이터 구분하기
2. 일급 추상(first-class abstraction)

## 2. 현실에서의 함수형 사고

계층형 설계(stratified design)는 비즈니스 규칙, 도메인 규칙, 기술 스택 계층으로 나뉜다.

액션은 시간에 의존한다. 따라서 올바른 순서로 동작하는 프로그램을 만들려면 액션에 주의해야 한다.

3~9장에서는 액션, 계산, 데이터의 차이에 대해 다룬다.

## 3. 액션과 계산, 데이터의 차이를 알기

함수형 프로그래밍에서의 일반적인 구현 순서는 다음과 같다.

1. 데이터
2. 계산
3. 액션

**액션보다 계산이 쉽고, 계산보다 데이터가 쉽다.**

### 데이터

데이터의 장점은 다음과 같다.

- 직렬화
- 동일성 비교
- 자유로운 해석

데이터는 해석이 반드시 필요하다. 해석하지 않은 데이터는 쓸모없는 바이트일 뿐이다.

사전적으로 데이터는 **이벤트에 대한 사실**이다. 함수형 프로그래밍에서는 이를 다음과 같이 해석할 수 있다.

- 데이터가 해석이 필요하다는 점을 내포한다.
- 개발자가 정보 처리 시스템을 만든다는 점을 강조한다.

### 계산

계산이 액션보다 좋은 이유는 다음과 같다.

- 테스트가 쉽다.
- 기계적인 분석이 쉽다.
- 계산은 조합하기 좋다.

### 액션

**액션은 코드 전체로 퍼진다.** 액션을 호출하는 함수는 액션이 된다. 함수형 프로그래밍에서는 액션을 잘 다루는 방법을 고민한다.

액션의 구체적인 코드 예는 다음과 같다.

```js
// 함수 호출
alert('Hello world!');

// 메서드 호출
console.log('hello');

// 생성자
new Date()

// 표현식(참조)
y
user.firstName
stack[0]

// 상태
z = 3;
delete user.firstName;
```

자바스크립트에서는 계산과 액션 모두 함수로 구현되기 때문에 구별이 쉽지 않다.

액션은 사용하기 어렵지만 액션이 없는 소프트웨어는 쓸모가 없다. 우리는 액션을 잘 사용하기 위해 노력해야 하며 구체적인 방법은 다음과 같다.

1. 액션을 가능한 적게 사용한다.
2. 액션을 가능한 작게 만든다.
3. 액션이 외부 세계와 상호작용하는 것을 제한한다. 가장 바깥쪽에 액션이 있는 구조가 이상적이다.
4. 액션이 호출 시점에 의존하는 것을 제한한다.

## 4. 액션에서 계산 빼내기

테스트하기 쉬우려면 DOM 업데이트와 비즈니스 규칙이 분리되어야 한다. 전역 변수가 없어야 한다.

다음 예시를 통해 함수의 암묵적 입출력과 명시적 입출력에 대해 파악할 수 있다.

```js
let total = 0;

function addToTotal(amount) { // amount 인자는 명시적 입력
	console.log('Old total: ' + total); // total 전역 변수를 읽는 것은 암묵적 입력. 콘솔에 출력하는 것은 암묵적 출력
	total = total + amount; // total 전역 변수를 읽고 변경하는 것은 암묵적 입출력
	
	return total; // 반환값은 명시적 출력
}
```

함수 안으로 데이터가 들어오면 입력, 함수 밖으로 데이터가 나가면 출력이다.

함수의 인자와 반환값은 명시적이다. 인자와 반환값을 제외한 모든 입출력은 암묵적이다. 암묵적 입출력을 **부수 효과**라고 부른다.

**함수에 암묵적 입력이나 출력이 있으면 액션이 된다.** 액션에서 암묵적 입력과 출력을 없애면 계산이 된다.

전역 변수는 암묵적 입출력이 되므로 주의해서 사용해야 한다.

## 5. 더 좋은 액션 만들기