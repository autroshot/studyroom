# 4장 커넥션 관리

## 1. TCP 커넥션

모든 HTTP 통신은 패킷 교환 네트워크 프로토콜들의 계층화된 집합인 TCP/IP를 통해 이루어진다. 일단 커넥션이 맺어지면 메시지들은 손실 또는 손상되거나 순서가 바뀌지 않고 안전하게 전달된다.

### 신뢰할 수 있는 데이터 전송 통로인 TCP

HTTP 커넥션은 몇몇 사용 규칙을 제외하고는 TCP 커넥션에 불과하다. TCP 커넥션은 인터넷을 안정적으로 연결해준다.

### TCP 스트림은 세그먼트로 나뉘어 IP 패킷을 통해 전송된다

TCP는 IP 패킷(혹은 IP 데이터그램)이라는 작은 조각을 통해 데이터를 전송한다.

HTTP는 프로토콜 스택에서 최상위 계층이다. HTTPS는 HTTP에 보안 기능을 더한 것이다. TLS 혹은 SSL이라 불리는 암호화(cryptographic encryption) 계층이다.

| 계층         | HTTP                | HTTPS               |
| ------------ | ------------------- | ------------------- |
| 애플리케이션 | HTTP                | HTTP                |
| 보안         |                     | TLS 또는 SSL        |
| 전송         | TCP                 | TCP                 |
| 네트워크     | IP                  | IP                  |
| 데이터 링크  | 네트워크 인터페이스 | 네트워크 인터페이스 |

TCP는 세그먼트라는 단위로 데이터 스트림을 잘게 나누고, 세그먼트를 IP 패킷이라고 불리는 봉투에 담아서 인터넷을 통해 데이터를 전달한다. 이 모든 것은 TCP/IP 소프트웨어에 의해 처리되며, 그 과정은 프로그래머에게 보이지 않는다.

IP 패킷에는 다음이 포함된다.

- IP 패킷 헤더(보통 20바이트): 발신지와 목적지 IP 주소, 크기, 기타 플래그
- TCP 세그먼트 헤더(보통 20바이트): TCP 포트 번호, TCP 제어 플래그, 데이터의 순서와 무결성을 검사하기 위해 사용되는 숫자 값
- TCP 데이터 조각(0 혹은 그 이상의 바이트)

### TCP 커넥션 유지하기

컴퓨터는 항상 TCP 커넥션을 여러 개 가지고 있다. TCP는 포트 번호를 통해서 이런 여러 개의 커넥션을 유지한다.

TCP 커넥션은 다음 네 가지 값으로 식별된다. 서로 다른 두 개의 TCP 커넥션은 네 가지 구성요소의 값이 모두 같을 수 없다.

- 발신지 IP 주소
- 발신지 포트
- 수신지 IP 주소
- 수신지 포트

### TCP 소켓 프로그래밍

## 2. TCP의 성능에 대한 고려

TCP 프로토콜 내부를 자세히 알아야 하므로 필요할 때 찾아보자.