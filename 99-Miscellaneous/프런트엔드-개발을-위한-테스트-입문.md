# 프런트엔드 개발을 위한 테스트 입문

프런트엔드에는 테스트 방법이 너무 많아서 어떤 테스트가 필요한지 파악하기 어렵다. 반대로 선택지가 많다는 것은 상황에 맞게 최적의 방법을 고를 수 있다는 의미이기도 하다.

이 책에서는 상황에 맞는 테스트 방법의 조합 행위를 **테스트 전략**이라고 정의한다.

## 테스트 목적과 장애물

프런트엔드에서 사용하는 테스트 방법은 다음과 같이 분류할 수 있다.

- 함수 단위 테스트
- UI 컴포넌트와 단위 테스트
- UI 컴포넌트와 통합 테스트: 외부 API에 데이터를 요청하는 것과 같이 외부 요인이 포함된 테스트이다.
- UI 컴포넌트와 시각적 회귀 테스트
- E2E 테스트: 실제 애플리케이션에 유사한 환경에서 진행되는 테스트이다.

테스트를 작성해야 하는 이유는 다음과 같다.

- 사업의 신뢰성
- 높은 유지보수성: 자신 있는 리팩터링이 가능해진다.
- 코드 품질 향상: 테스트 작성이 어렵다면 해당 코드가 너무 많은 역할을 한다는 의미일 수 있다.
- 웹 접근성 향상: 대상을 선택할 때 웹 접근성에 기반한 API를 사용할 때가 많다.
- 원활한 협업: 테스트 코드는 문서보다 우수한 사양서다.

테스트를 작성하면 단기적으로 테스트 작성 시간이 소모되지만 장기적으로는 시간이 절약된다.

'다음부터 테스트를 작성하자'는 접근법은 성공하기 어렵다. 나중에는 코드가 많아져서 테스트를 작성하기가 더 힘들어진다.

## 테스트 방법과 테스트 전략

### 테스트 범위

프런트엔드 개발의 테스트 범위(레벨)는 크게 네 가지로 분류한다.

- 정적 분석: 타입스크립트나 ESLint
- 단위 테스트: 어떤 모듈이 특정 입력값을 받아 기대하는 출력값을 반환하는지 테스트한다.
- 통합 테스트: 여러 모듈을 연동한 기능을 테스트한다.
- E2E 테스트

### 테스트 목적

테스트 타입은 테스트 목적에 따라 분류된다.

- 기능 테스트(인터랙션 테스트): 웹 프런트엔드의 주요 개발 대상은 사용자가 조작할 UI 컴포넌트이다. 따라서 프런트엔드의 기능 테스트는 인터랙션 테스트가 대부분이다. 리액트에서는 보통 가상 브라우저 환경에서 테스트를 진행하나 스크롤이나 스토리지가 필요할 때는 헤드리스 브라우저를 이용한다.
- 비기능 테스트(접근성 테스트)
- 시각적 회귀 테스트: 캡처된 이미지 간 차이를 검증한다.

### 테스트 전략 모델

다음은 테스트 범위와 비용의 상관관계를 나타낸 그림이다.

[그림]

테스트 비용 간 비용 분배는 테스트 전략을 세울 때 가장 중요한 검토 사항이다. 비용 분배 최적화에 참고할 수 있는 테스트 전략 모델을 몇 가지 살펴보자.

다음은 안티패턴으로 자주 언급되는 아이스크림 콘(ice cream cone)이다. 상층부 테스트의 비중이 높다.

[그림]

다음은  테스트 피라미드(testing pyramid)이다. 하층부 테스트의 비중이 높을수록 더욱 안정적이고 가성비 높은 테스트가 가능하다. 이 전략이 우수하다는 의견이 지배적이다.

[그림]

다음은 테스팅 트로피(testing trophy)이다. 켄트 도즈(Kent C. Dodds)가 고안했다. 이 모델의 핵심은 통합 테스트 비중이 높아야 한다는 것이다. 단일 UI 컴포넌트로 구현되는 기능은 거의 없기 때문이다.

### 테스트 전략 계획

- 테스트가 없는 경우: 회귀 테스트와 목 서버를 활용한다.
- 반응형 웹: 브라우저를 활용한 시각적 회귀 테스트를 활용한다. 스토리북을 사용하면 UI 컴포넌트 단위로 시각적 회귀 테스트가 가능하다.
- 데이터베이스를 포함한 E2E 테스트가 필요한 경우: 실제 웹 API 서버를 사용한 E2E 테스트를 하고 싶다면 테스트용 스테이징 환경을 사용해야 한다. 스테이징 환경 대신 도커 컨테이너(컴포즈)를 이용할 수도 있다.