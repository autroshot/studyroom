# 코드에서 나는 악취

| 악취                                 | 탈취용 리팩터링 기법                                         |
| ------------------------------------ | ------------------------------------------------------------ |
| 기이한 이름                          | 함수 선언 바꾸기, 변수 이름 바꾸기, 필드 이름 바꾸기         |
| 중복 코드                            | 함수 추출하기, 문장 슬라이드하기, 메서드 올리기              |
| 긴 함수                              | 함수 추출하기(99%), 임시 변수를 질의 함수로 바꾸기, 매개변수 객체 만들기, 객체 통째로 넘기기, 함수를 명령으로 바꾸기, 조건문 분해하기, 함수 추출하기, 조건부 로직을 다형성으로 바꾸기, 반복문 쪼개기 |
| 긴 매개변수 목록                     | 매개변수를 질의 함수로 바꾸기, 객체 통째로 넘기기, 매개변수 객체 만들기, 플래그 인수 제거하기, 여러 함수를 클래스로 묶기 |
| 전역 데이터                          | 변수 캡슐화하기                                              |
| 가변 데이터                          | 변수 캡슐화하기, 변수 쪼개기, 문장 슬라이드하기, 함수 추출하기, 질의 함수와 변경 함수 분리하기, 세터 제거하기, 파생 함수를 질의 함수로 바꾸기, 여러 함수를 클래스로 묶기, 여러 함수를 변환 함수로 묶기, 참조를 값으로 바꾸기 |
| 뒤엉킨 변경                          | 단계 쪼개기, 함수 옮기기, 함수 추출하기, 클래스 추출하기     |
| 산탄총 수술                          | 함수 옮기기, 필드 옮기기, 여러 함수를 클래스로 묶기, 여러 함수를 변환 함수로 묶기, 단계 쪼개기, 함수 인라인하기, 클래스 인라인하기 |
| 기능 편애                            | 함수 옮기기, 함수 추출하기, 함수 옮기기                      |
| 데이터 뭉치                          | 클래스 추출하기, 매개변수 객체 만들기, 객체 통째로 넘기기    |
| 기본형 집착                          | 기본형을 객체로 바꾸기, 타입 코드를 서브클래스로 바꾸기, 조건부 로직을 다형성으로 바꾸기, 클래스 추출하기, 매개변수 객체 만들기 |
| 반복되는 switch문                    | 조건부 로직을 다형성으로 바꾸기                              |
| 반복문                               | 반복문을 파이프라인으로 바꾸기                               |
| 성의 없는 요소                       | 함수 인라인하기, 클래스 인라인하기, 계층 합치기              |
| 추측성 일반화                        | 계층 합치기, 함수 인라인하기, 클래스 인라인하기, 함수 선언 바꾸기, 죽은 코드 제거하기 |
| 임시 필드                            | 클래스 추출하기, 함수 옮기기, 특이 케이스 추가하기           |
| 메시지 체인                          | 위임 숨기기, 함수 추출하기, 함수 옮기기                      |
| 중개자                               | 중개자 제거하기, 함수 인라인하기                             |
| 내부자 거래                          | 함수 옮기기, 필드 옮기기, 위임 숨기기, 서브클래스를 위임으로 바꾸기, 슈퍼클래스를 위임으로 바꾸기 |
| 거대한 클래스                        | 클래스 추출하기, 슈퍼클래스 추출하기, 타입 코드를 서브클래스로 바꾸기 |
| 서로 다른 인터페이스의 대안 클래스들 | 함수 선언 바꾸기, 함수 옮기기, 슈퍼클래스 추출하기           |
| 데이터 클래스                        | 레코드 캡슐화하기, 세터 제거하기, 함수 옮기기, 함수 추출하기, 단계 쪼개기 |
| 상속 포기                            | 메서드 내리기, 필드 내리기, 서브클래스를 위임으로 바꾸기, 슈퍼클래스를 위임으로 바꾸기 |
| 주석                                 | 함수 추출하기, 함수 선언 바꾸기, 어서션 추가하기             |

### 1. 기이한 이름

마땅한 이름이 떠오르지 않는다면 설계에 더 근본적인 문제가 숨어 있을 가능성이 높다.

### 3. 긴 함수

짧은 함수로 구성된 코드를 이해하기 쉽게 만드는 가장 확실한 방법은 좋은 이름이다. 함수 이름을 잘 지어두면 본문 코드를 볼 이유가 사라진다.

주석을 달 만한 부분을 함수로 만든다. 함수의 본문에는 원래 주석으로 설명하려던 코드가 담기고, 함수 이름은 동작 방식이 아닌 **의도**가 드러나게 짓는다.

원래 코드보다 길어지더라도 함수로 뽑는다. 핵심은 함수의 길이가 아닌, 함수의 목적(의도)과 구현 코드의 괴리가 얼마나 큰가다. **무엇을 하는지**를 코드가 잘 설명해주지 못할수록 함수로 만드는 게 유리하다.

### 5. 전역 데이터

전역 데이터는 악취 중 가장 지독한 축에 속한다. 전역 데이터는 코드베이스 어디에서든 건드릴 수 있고 값을 누가 바꿨는지 찾아낼 메커니즘이 없다는 게 문제다.

### 7. 뒤엉킨 변경

뒤엉킨 변경은 단일 책임 원칙(Single Responsibility Principle)이 제대로 지켜지지 않을 때 나타난다.

예컨대 지원해야 할 데이터베이스가 추가될 때마다 함수 세 개를 바꿔야 한다면 뒤엉킨 변경이 발생했다는 뜻이다.

### 8. 산탄총 수술

|                 | 뒤엉킨 변경             | 산탄총 수술          |
| --------------- | ----------------------- | -------------------- |
| 원인            | 맥락을 잘 구분하지 못함 | 동일                 |
| 해법(원리)      | 맥락을 명확히 구분      | 동일                 |
| 발생 과정(현상) | 한 코드에 섞여 들어감   | 여러 코드에 흩뿌려짐 |
| 해법(실제 행동) | 맥락별로 분리           | 맥락별로 모음        |

### 9. 기능 편애

기능 편애는 흔히 어떤 함수가 자기가 속한 모듈의 함수나 데이터보다 다른 모듈의 함수나 데이터와 상호작용을 할 일이 더 많을 때 풍기는 냄새다.

### 10. 데이터 뭉치

데이터 항목 서너 개가 여러 곳에서 항상 함께 뭉쳐 다니는 모습을 보이면 보금자리를 따로 마련해줘야 마땅하다.

### 11. 기본형 집착

전화번호를 단순히 문자열로만 표현하는 것이 대표적인 예시이다.

### 14. 성의 없는 요소

함수, 클래스, 인터페이스와 같은 프로그램 요소가 필요 없을 때도 있다.

### 16. 임시 필드

간혹 특정 상황에서만 값이 설정되는 필드를 가진 클래스가 있다.

### 17. 메시지 체인

메시지 체인은 클라이언트가 한 객체를 통해 다른 객체를 얻은 뒤 방금 얻은 객체에 또 다른 객체를 요청하는 식으로, 객체를 요청하는 작업이 연쇄적으로 이어지는 코드를 말한다.

### 19. 내부자 거래

개발자는 모듈 사이의 벽을 두껍게 세우기를 좋아하며, 모듈 사이의 데이터 거래가 많으면 결합도(coupling)가 높아진다고 투덜댄다.

### 24. 주석

**주석을 남겨야겠다는 생각이 들면, 가장 먼저 주석이 필요 없는 코드로 리팩터링해본다.**