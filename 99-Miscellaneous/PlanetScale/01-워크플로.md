# 워크플로

## 서버리스 데이터베이스

플래닛스케일 데이터베이스는 개발자와 개발자 워크플로를 위해 설계되었다. MySQL의 안정성(플래닛스케일 데이터베이스는 MySQL 8.0에서 실행됨)과 오픈 소스 Vitess의 규모를 갖춘 완전 관리형 데이터베이스를 단 10초 만에 배포할 수 있다.

UI에서 직접 데이터베이스를 배포, 브랜치, 쿼리하거나 [CLI](https://github.com/planetscale/cli#installation)에서 명령어를 실행할 수 있다.

내장 연결 풀링 덕분에 데이터베이스에 대한 연결 제한이 없어진다.

## 플래닛스케일 브랜치

플래닛스케일 브랜치 기능을 사용하면 격리된 개발 환경으로 사용할 프로덕션 데이터베이스 스키마의 브랜치를 만들어 데이터베이스를 코드처럼 처리할 수 있다.

플래닛스케일은 **개발**과 **프로덕션**이라는 두 가지 유형의 데이터베이스 브랜치를 제공한다.

개발 브랜치는 CI를 변경, 실험, 실행할 수 있는 데이터베이스 스키마의 격리된 복사본을 제공한다. 프로덕션 데이터베이스를 즉시 브랜치하여 스키마 변경 사항을 테스트하기 위한 스테이징 환경을 만든다.

프로덕션 브랜치는 프로덕션 트래픽을 위한 고가용성 데이터베이스이다. 기본적으로 직접적인 스키마 변경으로부터 보호되며 자동화된 일일 백업이 포함된다.

또한 스키마와 데이터를 모두 포함하는 개발용 데이터베이스의 격리된 복제본을 생성할 수 있는 [데이터 브랜칭™](https://planetscale.com/docs/concepts/data-branching) 기능을 제공한다.

데이터베이스 브랜칭에 대한 자세한 내용은 [이곳](https://planetscale.com/docs/concepts/branching)에서 확인한다.

## 논블로킹 스키마 변경

플래닛스케일을 사용하면 스키마 변경 사항을 프로덕션에 안전하게 배포하고 CI/CD 프로세스의 일부로 스키마 관리를 쉽게 자동화할 수 있다. 플래닛스케일 스키마 변경 사항은 온라인으로 적용되며 마이그레이션 중에 데이터베이스를 차단하거나 개별 테이블을 잠그거나 생산 속도를 늦추는 변경 사항으로부터 보호할 수 있다.

개발 브랜치를 사용하여 스키마 변경 사항을 적용하고 UI나 CLI에서 스키마 차이점을 볼 수 있다. 스키마 변경 사항에 만족하면 배포 요청을 열 수 있다.

논블록킹 스키마 변경에 대한 자세한 내용은 [이곳](https://planetscale.com/docs/concepts/nonblocking-schema-changes)에서 확인한다.

## 배포 요청

[배포 요청](https://planetscale.com/docs/concepts/deploy-requests)을 통해 스키마 변경을 제안하고 팀으로부터 피드백을 받을 수 있다. 배포 요청은 변경된 각 테이블에 대한 DDL문(`CREATE`, `ALTER`, `DROP`)을 줄별 스키마 차이와 함께 표시하므로 변경 사항을 쉽게 검토할 수 있다.

예를 들어 팀원들이 코드와 스키마 변경 사항을 동시에 검토할 수 있도록 배포 요청을 깃허브 풀 요청과 페어링할 수 있다.

또한 플래닛스케일은 배포 요청을 열 때 충돌에 대한 스키마 변경 사항을 분석한다. 브랜치가 생성된 시점의 프로덕션 스키마와 중간에 변경되었을 수 있는 현재 프로덕션 스키마를 확인한다. 이렇게 하면 프로덕션에 영향을 주지 않고 변경 사항을 안전하게 배포할 수 있다.

## 스키마 변경 배포하기

배포 요청이 승인되면 배포 대기열에 추가된다. 스키마 변경 사항은 배포 대기열에 추가되는 순서대로 프로덕션 데이터베이스 브랜치에 적용된다.

배포 대기열에 스키마 변경 사항을 추가하는 프로세스의 일부로 플래닛스케일은 잠재적 충돌에 대한 배포 요청에 앞서 해당 요청의 스키마 변경 사항을 분석한다. 충돌이 있는 경우, 배포 요청이 대기열에서 거부되고 충돌에 대한 알림을 즉시 받는다. 즉, 예상치 못한 충돌이 있는지를 알기 위해 스키마 변경 배포를 기다릴 필요가 없어진다. 이는 장기 실행 스키마 변경 사항이 적용되는 경우에 특히 유용한다.

## 스키마 변경 되돌리기

스키마 변경 배포 후에 이를 실행 취소해야 한다는 것을 깨닫게 되면 플래닛스케일이 이를 처리할 수 있다. [되감기 기능](https://planetscale.com/docs/concepts/deploy-requests#revert-a-schema-change)을 사용하면 30분 내에는 스키마 변경 배포를 실행 취소할 수 있다. 해당 배포 요청 페이지에서 '변경 사항 되돌리기' 버튼을 클릭하기만 하면 프로덕션 데이터베이스가 즉시 이전 스키마로 되돌아간다. 또한 배포와 되돌리기 사이의 시간에 프로덕션 데이터베이스에 추가된 모든 데이터는 유지된다.

