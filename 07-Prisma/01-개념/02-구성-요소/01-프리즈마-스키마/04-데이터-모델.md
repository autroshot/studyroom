# 데이터 모델

Prisma 스키마의 데이터 모델 정의 부분은 앱 모델(**Prisma 모델**이라고도 부름)을 정의한다.

모델의 역할은 다음과 같다.

- 앱 도메인 의 **엔터티**를 나타냄
- 데이터베이스의 **테이블**(PostgreSQL과 같은 관계형 데이터베이스) 또는 **컬렉션**(MongoDB)에 매핑
- 생성된 [Prisma Client API](https://www.prisma.io/docs/concepts/components/prisma-client)에서 사용 가능한 **쿼리**의 기초를 형성
- TypeScript와 함께 사용하면 Prisma Client는 모델에 대해 생성된 **타입 정의** 와 데이터베이스 접근을 완전히 안전한 타입으로 만들기 위한 모델의 [베리에이션](https://www.prisma.io/docs/concepts/components/prisma-client/advanced-type-safety/operating-against-partial-structures-of-model-types)을 제공

다음 스키마는 블로그 플랫폼을 설명한다.

```tsx
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id      Int      @id @default(autoincrement())
  email   String   @unique
  name    String?
  role    Role     @default(USER)
  posts   Post[]
  profile Profile?
}

model Profile {
  id     Int    @id @default(autoincrement())
  bio    String
  user   User   @relation(fields: [userId], references: [id])
  userId Int    @unique
}

model Post {
  id         Int        @id @default(autoincrement())
  createdAt  DateTime   @default(now())
  title      String
  published  Boolean    @default(false)
  author     User       @relation(fields: [authorId], references: [id])
  authorId   Int
  categories Category[] @relation(references: [id])
}

model Category {
  id    Int    @id @default(autoincrement())
  name  String
  posts Post[] @relation(references: [id])
}

enum Role {
  USER
  ADMIN
}
```

데이터 모델 정의는 다음으로 구성된다.

- 모델 간의 관계를 포함하여 여러 필드를 정의하는 모델
- 열거형(커넥터가 Enum을 지원하는 경우)
- 필드와 모델의 동작을 변경하는 속성과 함수

대응되는 데이터베이스는 다음과 같다.

<이미지>

하단의 쿼리는 이 데이터 모델에서 생성된 Prisma Client를 사용하여 다음을 생성한다.

- `User` 레코드
- 두 개의 중첩 `Post` 레코드
- 세 개의 중첩 `Category` 레코드

```tsx
const user = await prisma.user.create({
  data: {
    email: 'ariadne@prisma.io',
    name: 'Ariadne',
    posts: {
      create: [
        {
          title: 'My first day at Prisma',
          categories: {
            create: {
              name: 'Office',
            },
          },
        },
        {
          title: 'How to connect to a SQLite database',
          categories: {
            create: [{ name: 'Databases' }, { name: 'Tutorials' }],
          },
        },
      ],
    },
  },
})
```

데이터 모델은 앱 도메인을 반영한다.

예시:

- 전자 상거래 앱에는 `Customer`, `Order`, `Item`, `Invoice`와 같은 모델이 존재할 수 있다.
- 소셜 미디어 앱에는 `User`, `Post`, `Photo`, `Message`와 같은 모델이 존재할 수 있다.

## 분석과 마이그레이션

데이터 모델을 정의하는 방법은 두 가지가 있다.

- **데이터 모델을 직접 작성하고 Prisma Migrate 사용** - 데이터 모델을 직접 작성하고 [Prisma Migrate](https://www.prisma.io/docs/concepts/components/prisma-migrate)를 사용하여 데이터베이스에 매핑할 수 있다. 이 경우 데이터 모델은 앱 모델에 대한 믿을 만한 단일 소스이다.
- **분석을 통해 데이터 모델 생성** - 기존 데이터베이스가 있거나 데이터베이스 스키마를 SQL로 마이그레이션하는 것을 선호하는 경우 데이터베이스를 [분석](https://www.prisma.io/docs/concepts/components/introspection)하여 데이터 모델을 생성한다. 이 경우 데이터베이스 스키마는 앱 모델에 대한 믿을 만한 단일 소스이다.

## 모델 정의하기

모델은 앱 도메인의 엔터티를 나타낸다. 모델은 `model` 블록으로 표현되며 여러 필드를 정의한다. 예시 데이터 모델의 `User`, `Profile`, `Post`, `Category`가 모델이다.

블로그 플랫폼에 다음 모델을 추가하여 확장할 수 있다.

```tsx
model Comment {
  // 필드
}

model Tag {
  // 필드
}
```

### 테이블 또는 컬렉션에 모델 이름 매핑하기

Prisma 모델의 [명명 규칙(단수형, PascalCase)](https://www.prisma.io/docs/reference/api-reference/prisma-schema-reference#naming-conventions)은 데이터베이스의 테이블 이름과 항상 일치하지는 않는다. 데이터베이스에서 테이블/컬렉션의 이름을 짓는 일반적인 방식은 복수형과 [snake_case](https://en.wikipedia.org/wiki/Snake_case) 표기법을 사용하는 것이다(예: `comments`). 이름이 `comments`인 테이블이 있는 데이터베이스를 분석한 Prisma 모델 결과는 다음과 같다.

```tsx
model comments {
  // 필드
}
```

그러나 [`@@map`](https://www.prisma.io/docs/reference/api-reference/prisma-schema-reference#map-1) 속성을 사용하여 데이터베이스의 원래 테이블 이름인 `comments`을 바꾸지 않고도 명명 규칙을 계속 준수하는 것이 가능하다.

```tsx
model Comment {
  // 필드

  @@map("comments")
}
```

이 모델 정의를 통해 Prisma는 `Comment` 모델을 데이터베이스의 `comments` 테이블에 자동으로 매핑한다.

> **참고**
>
> 열 이름과 열거형 값을 [`@map`](https://www.prisma.io/docs/reference/api-reference/prisma-schema-reference#map)하고 열거형을 `@@map`할 수 있다.

`@map`과 `@@map`을 사용하여 데이터베이스의 테이블과 열 이름에서 모델과 필드 이름을 분리하여 [Prisma Client API의 모양을 조정할 수 있다](https://www.prisma.io/docs/concepts/components/prisma-client/working-with-prismaclient/use-custom-model-and-field-names#using-map-and-map-to-rename-fields-and-models-in-the-prisma-client-api).

