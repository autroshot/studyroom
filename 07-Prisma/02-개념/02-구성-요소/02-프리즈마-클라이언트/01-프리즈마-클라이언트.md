# 프리즈마 클라이언트

프리즈마 클라이언트는 데이터에 맞게 자동 생성되고 타입이 안전한 쿼리 빌더이다.

## 설정

### 1. 필요 조건

프리즈마 클라이언트를 설정하려면 데이터베이스 연결, 프리즈마 클라이언트 생성기, 하나 이상의 모델이 있는 프리즈마 스키마 파일이 필요하다.

```typescript
// schema.prisma

datasource db {
  url      = env("DATABASE_URL")
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  email     String   @unique
  name      String?
}
```

또한 프리즈마 CLI를 설치해야 한다.

```shell
npm install prisma --save-dev
npx prisma
```

### 2. 설치

다음 명령을 사용하여 프로젝트에 프리즈마 클라이언트를 설치한다.

```shell
npm install @prisma/client
```

이 명령은 또한 `prisma generate` 명령을 실행하여 `node_modules/.prisma/client` 디렉토리에 프리즈마 클라이언트를 생성한다.

### 3. 프리즈마 클라이언트를 사용하여 데이터베이스에 쿼리 보내기

```js
import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()
// 앱에서 prisma를 사용해 DB의 데이터를 읽고 쓴다.
```

`PrismaClient`를 인스턴스화한 후에는 코드에서 쿼리 보내기를 시작할 수 있다.

```js
// async 함수 안에서 동작한다.
const newUser = await prisma.user.create({
  data: {
    name: 'Alice',
    email: 'alice@prisma.io',
  },
})

const users = await prisma.user.findMany()
```

> **참고**
>
> 쿼리는 `await`와 함께 사용하거나 `.then()`으로 체이닝한 경우에만 동작한다. [`$transaction`](https://www.prisma.io/docs/concepts/components/prisma-client/transactions)을 사용하면 클라이언트가 모든 쿼리를 [쿼리 엔진](https://www.prisma.io/docs/concepts/components/prisma-engines/query-engine)에 트랜잭션으로 전달할 수 있다.

> **참고**
>
> 클라이언트 메소드는 [thenable](https://masteringjs.io/tutorials/fundamentals/thenable)이며 `await`을 사용하거나 `.then()`으로 체이닝한 쿼리를 제외하고는 JavaScript 프라미스처럼 구현된 프리즈마 프라미스를 반환한다.

### 4. 앱의 진화

프리즈마 스키마에 반영된 데이터베이스를 변경할 때마다 프리즈마 클라이언트를 수동으로 다시 생성하여 `node_modules/.prisma/client` 디렉토리에서 생성된 코드를 업데이트해야 한다.

```shell
prisma generate
```