# 1장: 논리 데이터베이스 설계

## 60섹션: 데이터베이스 설계

사용자의 요구를 분석하여 컴퓨터에 저장할 수 있는 데이터베이스의 구조에 맞게 변형한 후 특정 DBMS로 데이터베이스를 구현하는 것이다.

### 데이터베이스 설계 시 고려사항

- 무결성
- 일관성
- 회복
- 보안
- 효율성
- 데이터베이스 확장

### 데이터베이스 설계 순서

1. 요구 조건 분석
2. **개념적 설계**: 개념 스키마, 트랜잭션 모델링, E-R 모델
3. **논리적 설계(데이터 모델링)**: 목표 DBMS에 맞는 논리 스키마 설계 또는 변환(mapping), 트랜잭션 인터페이스 설계
4. **물리적 설계(데이터 구조화)**: 목표 DBMS에 맞는 물리적 구조의 데이터로 변환
5. 구현

물리적 설계에서는 저장 레코드의 양식, 순서, 접근 경로, 조회가 집중되는 레코드와 같은 정보를 사용하여 데이터가 저장되는 방법을 묘사한다.

물리적 설계 시 고려할 사항은 다음과 같다.

- 트랜잭션 처리량
- 응답 시간
- 디스크 용량
- 저장 공간의 효율화

## 61섹션: 데이터 모델의 개념

데이터 모델은 현실 세계의 정보들을 단순화, 추상화하여 체계적으로 표현한 **개념적 모형**이다.

### 데이터 모델의 구성 요소

- **개체(Entity)**: 데이터베이스에 표현하려는 것으로, 사람이 생각하는 개념이나 정보 단위 같은 현실 세계의 대상체이다.
- **속성(Attribute)**: 데이터의 가장 작은 논리적 단위로, 파일 구조상의 데이터 항목 또는 데이터 필드이다.
- **관계(Relationship)**: 개체 간의 관계 또는 속성 간의 논리적인 연결을 의미한다.

> [!NOTE]
>
> ##### 관계의 형태
>
> - 일 대 일(1:1)
> - 일 대 다(1:N)
> - 다 대 다(N:M)

### 개념적 데이터 모델

현실 세계에 대한 인식을 **추상적 개념**으로 표현하는 과정이다. E-R 모델이 대표적인 개념적 데이터 모델이다.

### 논리적 데이터 모델

개념적 모델링 과정에서 얻은 개념적 구조를 컴퓨터가 이해하고 처리할 수 있는 **컴퓨터 세계의 환경에 맞도록 변환**하는 과정이다. 단순히 **데이터 모델**이라고 부르기도 한다.

### 데이터 모델에 표시할 요소

- **구조(Structure)**: 데이터 구조 및 정적 성질
- **연산(Operation)**: 데이터를 처리하는 작업에 대한 명세로서 데이터베이스를 조작하는 기본 도구
- **제약 조건(Constraint)**: 데이터의 논리적인 제약 조건

## 62섹션: E-R(개체-관계) 모델

개념적 데이터 모델의 가장 대표적인 것으로 **피터 첸**이 제안했다.

- E-R 모델에서는 데이터를 개체, 속성, 관계로 묘사한다.
- 특정 DBMS를 고려하지 않는다.

### E-R 다이어그램

다음은 피터 첸 표기법에서의 기호들을 정리한 것이다.

- **사각형**: 개체 타입
- **마름모**: 관계 타입
- **타원**: 속성
- **이중 타원**: 다중값 속성(복합 속성)
- 복수 타원: 복합 속성
- 밑줄 타원: 기본키 속성
- **선, 링크**: 개체 타입과 속성을 연결
- 관계: 개체 간 관계에 대한 대응수를 선 위에 기술

## 63섹션: 관계형 데이터베이스의 구조

개체나 관계를 모두 릴레이션(Relation)이라는 표(Table)로 표현한다.

- 릴레이션은 개체 릴레이션과 관계 릴레이션으로 구분할 수 있다.
- 성능이 다소 떨어진다는 단점이 있다.

### 관계형 데이터베이스의 Relation 구조

릴레이션은 구조를 나타내는 릴레이션 스키마와 실제 값들인 릴레이션 인스턴스로 구성된다.

#### 튜플(Tuple)

- 릴레이션을 구성하는 각각의 행을 의미한다.
- 속성의 모임으로 구성된다.
- 파일 구조에서 레코드에 해당한다.
- 튜플의 수를 **카디널리티(Cardinality)** 또는 기수, 대응수라고 한다.

#### 속성(Attribute)

- 데이터베이스를 구성하는 가장 작은 논리적 단위이다.
- 개체의 특성을 기술한다.
- 파일 구조에서 데이터 항목 또는 데이터 필드에 해당한다.
- 속성의 수를 **디그리(Degree)** 또는 차수라고 한다.

#### 도메인(Domain)

- 하나의 속성이 취할 수 있는 원자(Atomic)값들의 집합이다.
- 속성 값의 합법 여부를 검사할 때 도메인을 사용하기도 한다. 예를 들어 성별 속성의 도메인은 '남'과 '여'로, 그 외의 값은 입력될 수 없다.

### 릴레이션의 특징

- 튜플이나 속성들 간의 순서는 중요하지 않다.
- 속성의 값은 더 이상 쪼갤 수 없는 원자값만을 저장한다.
- 속성의 명칭은 유일해야 하지만, 속성을 구성하는 값은 동일한 값이 있을 수 있다.

## 64섹션: 관계형 데이터베이스의 제약 조건 - 키

제약 조건은 데이터베이스에 저장되는 데이터의 정확성을 보장하기 위하여 키(Key)를 이용하여 **입력되는 데이터에 제한**을 주는 것이다.

### 키의 개념 및 종류

키는 튜플들을 서로 구분할 수 있는 기준이 되는 애트리뷰트를 말한다. 키의 종류에는 후보키, 기본키, 대체키, 슈퍼키, 외래키 등이 있다.

### 후보키(Candidate Key)

**튜플을 유일하게 식별하기 위해 사용하는 속성들의 부분집합**, 즉 기본키로 사용할 수 있는 속성들을 말한다.

- 모든 릴레이션에는 반드시 하나 이상의 후보키가 존재한다.
- 후보키는 모든 튜플에 대해 유일성과 최소성을 만족해야 한다.
  - **유일성(Unique)**: 하나의 키 값으로 하나의 튜플만을 유일하게 식별
  - **최소성(Minimality)**: 꼭 필요한 속성으로만 구성

### 기본키(Primary Key)

후보키 중에서 선정된 주키(Main Key)이다.

- 기본키는 후보키의 성질을 갖는다. 즉, 유일성과 최소성을 가진다.
- 기본키는 **NULL 값을 가질 수 없다.**

### 대체키(Alternate Key)

후보키가 둘 이상일 때 **기본키를 제외한 나머지 후보키**를 의미한다. 보조키라고도 한다.

### 슈퍼키(Super Key)

속성들의 집합으로 구성된 키이다.

- **슈퍼키는 유일성은 만족하지만, 최소성은 만족하지 못한다.**

### 외래키(Foreign Key)

**다른 릴레이션의 기본키를 참조하는 속성 또는 속성들의 집합**을 의미한다.

- 외래키는 릴레이션 간의 **참조 관계를 표현**한다.
- 참조 릴레이션의 기본키에 없는 값은 입력할 수 없다.
- Null을 입력할 수 있다.
- 외래키는 중복이 허용되므로, 유일성과 최소성을 가질 수 없다.

## 65섹션: 관계형 데이터베이스의 제약 조건 - 무결성

무결성은 데이터베이스에 저장된 데이터 값과 현실 세계의 실제 값이 일치하는 정확성을 의미한다. 무결성 제약 조건은 데이터의 정확성을 보장하기 위해 부정확한 자료가 데이터베이스에 저장되는 것을 방지하기 위한 것이다.

무결성의 종류는 다음과 같다.

- **개체 무결성(Entity Integrity, 실체 무결성): 기본 테이블의 기본키를 구성하는 어떤 속성도 Null 값이나 중복값을 가질 수 없다.**
- **도메인 무결성(Domain Integrity, 영역 무결성): 속성 값이 정의된 도메인에 속한 값이어야 한다.**
- **참조 무결성(Referential Integrity): 외래키 값은 Null이거나 참조 릴리이션의 기본키 값과 동일해야 한다.**
- **사용자 정의 무결성(User-Defined Integrity)**

### 데이터 무결성 강화

데이터 무결성은 애플리케이션, 트리거, 제약 조건을 이용하여 강화할 수 있다.

- 애플리케이션: 복잡한 요구 조건 구현 가능. 관리가 어려움
- 트리거: 복잡한 요구 조건 구현 가능. 운영 중 변경이 어려움
- 제약 조건: 복잡한 요구 조건 구현과 예외적인 처리가 불가능

## 66섹션: 관계대수 및 관계해석

관계대수는 관계형 데이터베이스에서 **원하는 정보와 그 정보를 검색**하기 위하여 어떻게 유도하는가를 기술하는 **절차적인 언어**이다.

- 관계대수는 릴레이션을 처리하는 연산자와 연산규칙을 제공하는 언어로, 피연산자와 결과 모두 릴레이션이다.
- 관계대수에는 관계 데이터베이스를 위해 특별히 만든 순수 관계 연산자와, 수학적 집합 이론에서 사용하는 일반 집합 연산자가 있다.
  - **순수 관계 연산자**: Select, Project, Join, Division
  - **일반 집합 연산자**: UNION(합집합), INTERSECTION(교집합), DIFFERENCE(차집합), CARTESIAN PRODUCT(교차곱)

### Select

선택 조건을 만족하는 튜플의 부분집합을 구한다.

- 릴레이션의 행을 구하므로 수평 연산이라고도 한다.
- 표기 형식: $σ_{<조건>}(R)$
  - 조건에서는 비교 연산(=, < 등)이 허용되며 AND, OR, NOT 등의 논리 연산자를 사용하여 여러 조건들을 결합할 수 있다.
- 예) $σ_{Avg≥90}(성적)$

### Project

속성 리스트에 제시된 속성 값만을 추출한다. 

- 릴레이션의 열을 구하므로 수직 연산이라고도 한다.
- 표기 형식: $π_{<속성리스트>}(R)$
- 예: $π_{Name, Avg}({성적})$

### Join

공통 속성을 중심으로 두 개의 릴레이션을 하나로 합친다.

- Join의 결과로 만들어진 릴레이션의 차수는 조인된 두 릴레이션의 차수를 합한 것과 같다.
- Join의 결과는 교차곱을 수행한 다음 Select를 수행한 것과 같다.
- Join 조건이 '='일 때 동일한 속성이 2번 나타나게 된다.
- 표기 형식: $R⨝_{키속성r=키속성s}S$
- 예) $성적⨝_{No=No}{학적부}$

> [!NOTE]
>
> ##### 자연 조인(Natural Join)
>
> 중복 속성을 제거하여 같은 속성을 한 번만 표기하는 방법이다.
>
> - 자연 조인이 성립되려면 두 릴레이션의 속성명과 도메인이 같아야 한다.
> - 예) $성적⨝_{No}{학적부}$

### Division

X⊃Y인 두 릴레이션 R(X)와 S(Y)가 있을 때, R의 속성이 S의 속성 값을 모두 가진 튜플에서 S가 가진 속성만을 제외한 속성만을 구한다.

- 표기 형식: $R[속성r÷속성s]S$
  - 속성 r과 속성 s는 동일 속성값을 가지는 속성이여야 한다.
  - R에서 S와 연관되어 있는 튜플만 추출하고 속성 s를 제외한다.

### 일반 집합 연산자

- 교차곱을 제외한 합집합, 교집합, 차집합은 합병 조건을 만족해야 한다. 합병 조건은 두 릴레이션 간의 속성 수가 같고 각 속성별로 도메인이 같아야 한다.
- 교차곱의 디그리는 두 릴레이션의 디그리를 더한 것과 같고, 카디널리티는 두 릴레이션의 카디널리티를 곱한 것과 같다.
- 예) ${π_{이름}{(사원)}}∪{π_{이름}{(사원)}}$

### 관계해석(Relational Calculus)

관계 데이터의 **연산을 표현하는 방법**으로, 원하는 정보를 정의할 때는 **계산 수식**을 사용한다. 코드(E. F. Codd)가 수학의 술어 해석(Predicate Calculus, 프레디킷 해석)에 기반을 두고 관계 데이터베이스를 위해 제안했다.

- 원하는 정보가 무엇이라는 것만 정의하는 **비절차적 특성**을 지닌다.

- 튜플 관계해석과 도메인 관계해석이 있다.

- 질의어로 표현한다.

- 관계해석과 관계대수는 관계 데이터베이스를 처리하는 기능면에서 동등하며, 관계 대수로 표현한 식은 관계해석으로 표현할 수 있다.

- 주요 논리 기호는 다음과 같다.

  | 기호 | 구성 요소   | 설명                                        |
  | ---- | ----------- | ------------------------------------------- |
  | ∀    | 전칭 정량자 | 가능한 모든 튜플에 대하여(For All)          |
  | ∃    | 존재 전량자 | 하나라도 일치하는 튜플이 있음(There Exists) |

## 67섹션: 정규화(Normalization)

종속성 이론을 이용하여 잘못 설계된 관계형 스키마를 더 작은 속성의 세트로 쪼개어 바람직한 스키마로 만들어 가는 과정이다.

- 하나의 종속성이 하나의 릴레이션에 표현될 수 있도록 분해해간다.
- 데이터베이스의 **논리적 설계 단계**에서 수행한다.
- 정규화 수준이 높을수록 유연한 데이터 구축이 가능하고 데이터의 정확성이 높아지는 반면, 물리적 접근이 복잡하고 조인으로 인해 **성능이 저하**된다.

### 정규화의 목적

- 효과적인 검색 알고리즘
- 데이터 중복을 배제하여 이상 발생 방지 및 자료 저장 공간의 최소화
- 데이터 삽입 시의 릴레이션 재구성 필요성을 줄임

### 이상(Anomaly)의 개념 및 종류

- **삽입 이상(Insertion Anomaly)**: 의도치 않은 값들도 삽입됨
- **삭제 이상(Deletion Anomaly)**: 의도치 않은 값들도 삭제됨
- **갱신 이상(Update Anomaly)**: 일부 값만 갱신되어 정보에 모순이 생김

### 정규화 과정

1. **1NF(제1정규형): 도메인이 원자값**
2. **2NF(제2정규형): 부분적 함수 종속 제거**
3. **3NF(제3정규형): 이행적 함수 종속 제거(A → B이고 B → C일 때 A → C를 만족하는 관계)**
4. **BCNF(Boyce-Codd 정규형): 결정자이면서 후보키가 아닌 것 제거**
5. **4NF(제4정규형): 다치 종속 제거**
6. **5NF(제5정규형, PJ/NF): 조인 종속성 이용**

> [!NOTE]
>
> ##### 함수적 종속
>
> - 함수적 종속: 데이터들이 어떤 기준값에 의해 종속되는 것(A → B일 때 B는 A에 함수 종속적)
> - 완전 함수적 종속: 한 테이블에서 속성 A가 다른 속성 집합 B 전체에 대해 함수적 종속이고, 속성 집합 B의 진부분 집합 C에는 함수적 종속이 아닐 때. 어떤 속성이 기본키에 완전히 종속적일 때
> - 부분 함수적 종속: 한 테이블에서 속성 A가 다른 속성 집합 B 전체에 대해 함수적 종속이고, 속성 집합 B의 진부분 집합 C에도 함수적 종속일 때
> - 책의 예시 참고

## 68섹션: 반정규화(Denormalization)

**성능 향상 및 운영의 편의성** 등을 위해 의도적으로 **정규화 원칙을 위배**하는 행위이다.

반정규화 방법은 다음과 같다.

- 테이블 통합
- 테이블 분할
- 중복 테이블 추가
- 중복 속성 추가

### 테이블 통합

두 테이블이 조인되는 경우가 많아 하나의 테이블로 합치는 것이 성능에 도움이 될 경우 수행한다.

고려 사항은 다음과 같다.

- 데이터 검색은 간편하지만 레코드 증가로 처리량이 증가한다.
- 입력, 수정, 삭제 규칙이 복잡해질 수 있다.
- 제약조건을 설계하기 어렵다.

### 테이블 분할

테이블을 수평 또는 수직으로 분할한다.

- 수평 분할(Horizontal Partitioning): 레코드별로 사용 빈도의 차이가 클 때 분할한다.
- 수직 분할(Vertical Partitioning)
  - 갱신 위주의 속성 분할: 데이터 갱신 시의 레코드 잠금 방지
  - 자주 조회되는 속성 분할
  - 크기가 큰 속성 분할: 이미지나 2GB 이상의 텍스트 형식으로 된 속성
  - 보안이 필요한 속성 분할

고려 사항은 다음과 같다.

- 기본키의 유일성 관리가 어렵다.
- 수행 속도가 느려질 수 있다.
- 데이터 검색에 중점을 두어 분할 여부를 결정해야 한다.

### 중복 테이블 추가

방법은 다음과 같다.

- 집계 테이블의 추가: 각 원본 테이블에 트리거를 설정하여 사용한다. 트리거의 오버헤드에 유의해야 한다.
- 진행 테이블의 추가: 이력 관리에서 사용한다.
- 특정 부분만을 포함하는 테이블의 추가

### 중복 속성 추가

조인해서 데이터를 처리할 때 데이터 조회 경로를 단축하기 위해 자주 사용하는 속성을 하나 더 추가한다.

고려 사항은 다음과 같다.

- 테이블 및 속성 중복
- 데이터 일관성 및 무결성
- SQL 그룹 함수를 이용하여 해결 가능한지 확인
- 저장 공간의 지나친 낭비

## 69섹션: 시스템 카탈로그

**시스템 그 자체**에 관련이 있는 다양한 객체에 관한 정보를 포함하는 **시스템 데이터베이스**이다. 카탈로그를 **데이터 사전(Data Dictionary)**이라고도 한다.

### 시스템 카탈로그 저장 정보

시스템 카탈로그에 저장된 정보를 **메타 데이터(Meta-Data)**라고 한다.

메타 데이터의 유형은 다음과 같다.

- 데이터베이스 객체 정보: 테이블, 인덱스, 뷰 등의 구조 및 통계 정보
- 사용자 정보
- 테이블의 무결성 제약 조건 정보
- 함수, 프로시저, 트리거 등에 대한 정보

### 카탈로그의 특징

- 일반 이용자도 SQL을 이용하여 내용을 확인할 수 있다. 그러나 INSERT, DELETE, UPDATE문으로 카탈로그를 직접 갱신하는 것은 불가능하다.
- 데이터베이스 시스템에 따라 상이한 구조를 갖는다.
- DBMS가 스스로 생성하고 유지한다.
- **카탈로그의 갱신**: SQL문을 실행하여 기본 테이블, 뷰, 인덱스 등에 변화를 주면 시스템이 자동으로 갱신한다.
- **분산 시스템에서의 카탈로그**: 위치 투명성 및 중복 투명성을 제공하기 위해 필요한 모든 제어 정보를 가져야 한다.

### 카탈로그와 데이터 사전을 참고하기 위한 DBMS 내의 모듈 시스템

- 데이터 정의어 번역기(DDL Compiler)
- 데이터 조작어 번역기(DML Compiler)
- Data Directory: 시스템만 접근 가능
- 질의 최적화기
- 트랜잭션 처리기
