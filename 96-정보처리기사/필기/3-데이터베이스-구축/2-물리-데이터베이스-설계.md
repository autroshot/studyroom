# 2장: 물리 데이터베이스 설계

## 70섹션: 트랜잭션 분석/CRUD 분석

### 트랜잭션(Transaction) 정의

데이터베이스의 상태를 변화시키는 하나의 논리적 기능을 수행하기 위한 작업의 단위 또는 일련의 연산들이다.

### 트랜잭션의 상태

책의 그림을 참고한다.

- **활동(Active)**
- 실패(Failed)
- **철회(Aborted)**: 트랜잭션이 비정상적으로 종료되어 Rollback 연산을 수행한 상태
- **부분 완료(Partially Committed)**: Commit 연산 실행 전
- **완료(Committed)**: Commit 연산 실행 후

### 트랜잭션의 특성

데이터의 무결성을 보장하기 위하여 DBMS의 트랜잭션이 가져야 할 특성이다. 앞글자만 모아서 **ACID**라고 한다.

- **Atomicity(원자성)**: All or Nothing
- **Consistency(일관성)**
- **Isolation(독립성)**: 어느 하나의 트랜잭션 실행 중에 다른 트랜잭션의 연산이 끼어들 수 없다.
- **Durability(영속성, 지속성)**

### CRUD 분석

데이터베이스 테이블에 변화를 주는 트랜잭션의 CRUD 연산에 대해 CRUD 매트릭스를 작성하여 분석한다.

**CRUD 매트릭스**는 2차원 형태의 표로서, 행에는 프로세스를, 열에는 테이블이 위치한다. 각 셀에는 CRUD의 앞 글자가 들어간다.

**C, R, U, D 중 어느 것도 적히지 않은 행이나 열, C나 R이 없는 열을 확인할 필요가 있다.**

## 71섹션: 인덱스 설계

인덱스는 **데이터 레코드에 빠르게 접근**하기 위해 <키 값, 포인터> 쌍으로 구성되는 데이터 구조이다.

- 인덱스는 데이터가 저장된 물리적 구조와 밀접한 관계가 있다.
- 기본키를 위한 인덱스를 기본 인덱스라 하고 나머지는 보조 인덱스라고 한다.
- 레코드의 삽입과 삭제가 빈번한 경우에는 인덱스의 개수를 적게 하는 것이 좋다.
- 레코드의 물리적 순서가 인덱스의 엔트리 순서와 일치하게 구성되는 인덱스를 **클러스터드(Clustered) 인덱스**라고 한다.

인덱스의 종류와 설명은 책을 참고한다.

## 72섹션: 뷰 설계

뷰(View)는 사용자에게 접근이 허용된 자료만을 제한적으로 보여주기 위해 하나 이상의 기본 테이블(정의 테이블)로부터 유도된, **이름을 가지는 가상 테이블**이다.

- **물리적으로 존재하지는 않는다.**
- 임시적인 작업을 위한 용도로 활용된다.
- 사용자의 편의성이 향상된다.
- **뷰를 조작하는 명령어는 CREATE, DROP이다.**
- **데이터의 논리적 독립성을 제공할 수 있다.**

### 뷰의 단점

- **독립적인 인덱스를 가질 수 없다.**
- **뷰의 정의를 변경할 수 없다.**
- **CUD 연산에 제약이 따른다.**

### 뷰 설계 시 고려 사항

- 반복적으로 조인을 사용하거나 조건절을 사용하는 테이블을 뷰로 생성한다.
- 사용하는 관점에 따라 뷰를 생성한다.
- 보안 유지를 고려한다.

## 73섹션: 파티션 설계

파티션(Partition)은 대용량의 테이블이나 인덱스를 작은 논리적 단위인 **파티션으로 나누는 것**을 말한다.

- **파티션키**는 파티션을 나누는 기준이 되는 열이다.
- 데이터 처리는 테이블 단위, 데이터 저장은 파티션별로 수행된다.

### 파티션의 단점

- 테이블간 조인에 대한 비용 증가
- 용량이 작은 테이블에 적용하면 오히려 성능 저하

### 파티션의 종류

- **범위 분할(Range Partitioning)**
  - 지정한 열의 값을 기준으로 범위를 지정하여 분할
  - 예) 일별, 월별, 분기별
- **해시 분할(Hash Partitioning)**
  - 해시 함수를 적용한 결과 값을 기준으로 분할
  - 데이터를 고르게 분산할 때 유용하다.
  - 데이터가 고른 컬럼에 효과적이다.
  - 특정 데이터가 어디 있는지 판단할 수 없다.
  - 예) 고객 번호, 주민번호
- **조합 분할(Composite Partitioning)**
  - 범위 분할 뒤 해시 분할
  - 범위 분할한 파티션이 너무 클 때 유용하다.
- 목록 분할(List Partitioning)
  - 지정한 열 값에 대한 목록을 기준으로 분할
  - 예) '국가' 열에서 '아시아'라는 목록을 만듬
- **라운드 로빈 분할(Round Robin Partitioning)**
  - 레코드를 균일하게 분배
  - 각 레코드가 순차적으로 분배됨
  - 기본키 불필요

### 인덱스 파티션

파티션된 테이블의 데이터를 관리하기 위해 인덱스를 나눈 것이다.

- 테이블의 종속 여부
  - Local Partitioned Index: 테이블 파티션과 인덱스 파티션이 1:1 대응. 데이터 관리가 더 쉽다.
  - Global Partitioned Index: 테이블 파티션과 인덱스 파티션이 독립적
- 인덱스 파티션키 컬럼의 위치
  - Prefixed Partitioned Index: 인덱스 파티션키와 인덱스 첫 컬럼이 같음
  - Non-Prefixed Partitioned Index: 인덱스 파티션키와 인덱스 첫 컬럼이 다름

Local/Global, Prefixed/Nonprefixed를 조합하여 사용할 수 있다. 단, Global Non-Prefixed Partitioned Index는 허용되지 않는다.

## 74섹션: 분산 데이터베이스 설계

분산 데이터베이스는 논리적으로는 하나의 시스템에 속하지만 물리적으로는 네트워크를 통해 연결된 여러 곳에 분산되어 있는 데이터베이스를 말한다.

### 분산 데이터베이스의 구성 요소

- **분산 처리기**: 자체적인 처리 능력을 가지며, 지리적으로 분산되어 있는 컴퓨터 시스템
- **분산 데이터베이스**
- **통신 네트워크**: 분산 처리기들을 연결하는 통신망

### 분산 데이터베이스의 목표

여기서 투명성은 존재 여부를 신경 쓰지 않아도 된다는 것을 의미한다.

- **위치 투명성(Location Transparency)**
- **중복 투명성(Replication Transparency)**
- **병행 투명성(Concurrency Transparency)**: 트랜잭션 관련
- **장애 투명성(Failure Transparency)**

### 분산 데이터베이스의 단점

- 데이터베이스 설계의 어려움
- 개발 비용 증가
- 처리 비용 증가
- 잠재적 오류

### 분산 데이터베이스 설계

설계 방법은 다음과 같다.

- 테이블 위치 분산
- 분할(Fragmentation)
- 할당(Allocation)

#### 분할

테이블의 데이터를 분할한다.

**분할 규칙**은 다음과 같다.

- 완전성(Completeness)
- 재구성(Reconstruction)
- 상호 중첩 재체(Dis-jointness): 튜플이나 속성이 상호 중복되지 않아야 한다.

#### 할당

동일한 분할을 여러 개의 서버에 생성하는 것이다.

- 비중복 할당 방식: 분산 데이터베이스의 단일 노드에서만 분할이 존재하는 방식
- **중복 할당 방식**: 동일한 테이블을 다른 서버에 복제하는 방식

## 76섹션: 데이터베이스 보안-접근통제

접근통제는 데이터가 저장된 **객체**와 이를 사용하려는 **주체** 사이의 정보 흐름을 제한하는 것이다.

### 접근통제 기술

- **임의 접근통제(DAC; Discretionary Access Control)**
  - **데이터 소유자**가 접근통제 권한을 지정하고 제어한다.
  - 관련 SQL 명령어는 **GRANT**와 **REVOKE**가 있다.
- **강제 접근통제(MAC; Mandatory Access Control)**
  - 주체와 객체의 **보안 등급**을 비교하여 권한을 부여한다.
  - **시스템**이 접근통제 권한을 지정한다.
  - 주체는 자신보다 등급이 같은 객체에 대해서는 CRU이 가능하고, 낮은 객체에 대해서는 R이 가능하다.
- **역할기반 접근통제(RBAC; Role Based Access Control)**
  - 사용자의 역할에 따라 접근 권한을 부여한다.
  - **중앙관리자**가 접근통제 권한을 지정한다.
  - DAC와 MAC의 단점을 보완했으며, 다중 프로그래밍 환경에 최적화된 방식이다.

> [!NOTE]
>
> ##### MAC의 보안 모델
>
> - **벨 라파듈라 모델(Bell-LaPadula Model)**
>   - 사용자의 등급을 기준으로 읽기 권한과 쓰기 권한이 제한된다.
>   - 자신의 보안 레벨 이상의 문서를 작성할 수 있고, 이하의 문서를 읽을 수 있다.
> - 비바 무결성 모델(Biba Integrity Model): 벨 라파듈라 모델을 보완한 수학적 모델로, 무결성을 보장하는 최초의 모델
> - 클락-윌슨 무결성 모델(Clark-Wilson Integrity Model): 무결성 중심의 상업용 모델
> - 만리장성 모델(Chinese Wall Model): 서로 이해 충돌 관계에 있는 객체 간의 정보 접근을 통제하는 모델

### 접근통제의 3요소

- **접근통제 정책**
- **접근통제 매커니즘**: 정책을 구현하는 기술적인 방법
- **접근통제 보안 모델**: 정책을 구현하기 위한 정형화된 모델

자세한 내용은 책을 참고한다.

## 78섹션: 스토리지

단일 디스크로 처리할 수 없는 대용량의 데이터를 저장하기 위해 서버와 저장장치를 연결하는 기술이다.

종류는 다음과 같다.

- DAS
- NAS
- SAN

### DAS(Direct Attached Storage)

서버와 저장장치를 직접 연결하는 방식이다.

- 속도가 빠르고 설치 및 운영이 쉽다.
- 다른 서버에서 접근할 수 없고 파일을 공유할 수 없다.
- 확장성 및 유연성이 떨어진다.
- 구축 비용이 저렴하다.

### NAS(Network Attached Storage)

서버와 저장장치를 네트워크를 통해 연결하는 방식이다.

- 별도의 파일 관리 기능이 있는 NAS Storage가 내장된 저장장치를 직접 관리한다.
- 파일 공유가 가능하고, 장소에 상관없이 저장장치에 쉽게 접근할 수 있다.
- 확장성 및 유연성이 우수하다.
- 접속 증가 시 성능이 저하될 수 있다.

### SAN(Storage Area Network)

DAS의 빠른 처리와 NAS의 파일 공유 장점을 혼합한 방식으로, 서버와 저장장치를 연결하는 전용 네트워크를 별도로 구성하는 방식이다.

- 광 채널(FC) 스위치로 네트워크를 구성한다.
- 구축 비용이 많이 든다.
