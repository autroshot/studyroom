# 사전 렌더링과 데이터 가져오기

## 사전 렌더링

기본적으로 Next.js는 모든 페이지를 미리 렌더링한다. 즉 Next.js는 클라이언트 측 자바스크립트로 모든 작업을 수행하는 대신 각 페이지에 대해 미리 HTML을 생성한다 . 사전 렌더링은 더 나은 성능과 SEO를 제공한다 .

생성된 각 HTML은 해당 페이지에 필요한 최소한의 자바스크립트 코드와 연결된다. 브라우저에서 페이지를 로드하면 해당 자바스크립트 코드가 실행되고 페이지가 완전히 상호작용형으로 만들어진다. 이 과정을 **수화(hydration)**라고 한다.

다음 그림들은 사전 렌더링이 있을 때와 없을 때를 설명한다.

![pre-rendering](https://user-images.githubusercontent.com/95019875/176809979-293547c5-ffbd-4ac6-8def-d08d0ab693b6.png)

![no-pre-rendering](https://user-images.githubusercontent.com/95019875/176809996-62c9004d-d571-45fa-bc24-6629f6a2b27f.png)

## 두 가지 형태의 사전 렌더링

Next.js에는 정적 생성과 SSR의 두 가지 사전 렌더링 방식이 있다. 둘의 차이점은 페이지에 대한 HTML을 생성하는 시점이다.

- [**정적 생성**](https://nextjs.org/docs/basic-features/pages#static-generation-recommended)은 **빌드 시점**에서 HTML을 생성하는 사전 렌더링 방식이다. 사전 렌더링된 HTML은 각 요청에서 **재사용**된다.
- [**SSR**](https://nextjs.org/docs/basic-features/pages#server-side-rendering)은 **각 요청**에 대해 HTML을 생성하는 사전 렌더링 방식이다.

![static-generation](https://user-images.githubusercontent.com/95019875/176810020-8c7ed99f-787f-436c-a99a-f7d2d4c83195.png)

![server-side-rendering](https://user-images.githubusercontent.com/95019875/176810038-9b65b503-8644-4e4e-bc6b-cb7f00891d00.png)

> 개발 모드(`npm run dev`나 `yarn dev`를 실행할 때)에서는 정적 생성 페이지를 비롯한 모든 페이지가 각 요청에 대해 사전 렌더링된다.

### 페이지 단위 기준

Next.js를 사용하면 각 페이지에 사용할 사전 렌더링 방식을 선택할 수 있다. 대부분의 페이지에는 정적 생성을 사용하고 일부 페이지에는 SSR을 사용하여 **하이브리드** Next.js 앱을 만들 수 있다 .

### 정적 생성과 SSR은 각각 언제 사용해야 할까

정적 생성을 사용하면 페이지를 한 번만 만들고 CDN에서 제공할 수 있으므로 모든 요청에 대해 서버가 페이지를 렌더링하도록 하는 것보다 훨씬 빠르다. 따라서 가능하면 **정적 생성**을 사용하는 것이 좋다.

다음을 포함하여 다양한 유형의 페이지에 대해 정적 생성을 사용할 수 있다 .

- 마케팅 페이지
- 블로그 게시물
- 전자상거래 제품 목록
- 도움말 및 문서

"사용자의 요청에 앞서 해당 페이지를 미리 렌더링할 수 있을까?"라는 질문에 대한 대답이 "예"인 경우에는 정적 생성을 선택해야 한다.

반면 사용자의 요청보다 먼저 페이지를 미리 렌더링할 수 없는 경우에는 정적 생성이 좋은 생각은 아니다. 페이지에 자주 업데이트되는 데이터가 표시되고 모든 요청에 따라 페이지 콘텐츠가 변경되는 경우가 있을 수 있다.

이 경우에는 SSR을 사용할 수 있다. 속도는 느려지지만 미리 렌더링된 페이지는 항상 최신 상태로 유지된다. 또는 사전 렌더링을 건너뛰고 클라이언트 측 자바스크립트를 사용하여 자주 업데이트되는 데이터를 채울 수 있다.

### 데이터가 없는 정적 생성과 데이터가 있는 정적 생성

정적 생성은 데이터 유무에 관계없이 수행할 수 있다.

외부 데이터를 가져올 필요가 없는 페이지는 앱이 생산용으로 빌드될 때 자동으로 정적으로 생성된다.

![static-generation-without-data](https://user-images.githubusercontent.com/95019875/176810078-8684b736-a1dc-4d70-ba60-fe5a576a915d.png)

그러나 일부 페이지의 경우에는 먼저 외부 데이터를 가져오고 HTML을 렌더링해야 한다. 빌드 타임에서 파일 시스템에 접근하거나, 외부 API를 가져오거나, 데이터베이스를 쿼리해야 할 수도 있다. Next.js는 [데이터가 있는 정적 생성](https://nextjs.org/docs/basic-features/pages#static-generation-with-data)을 기본적으로 지원한다.

![static-generation-with-data](https://user-images.githubusercontent.com/95019875/176810109-02a687cb-a393-4e05-9ff3-86702ec8c249.png)

### `getStaticProps`을 이용해 데이터가 있는 정적 생성하기

Next.js에서 페이지 컴포넌트를 내보낼 때 [`getStaticProps`](https://nextjs.org/docs/basic-features/data-fetching/get-static-props)라는 `async` 함수를 내보낼 수 있다. 이 함수를 내보내면 다음과 같이 된다.

- `getStaticProps`가 생산에서 빌드 타임에 실행된다.
- 함수 내부에서 외부 데이터를 가져와 페이지에 props로 전달할 수 있다.

```jsx
export default function Home(props) { ... }

export async function getStaticProps() {
  // 파일 시스템, API, DB 등에서 외부 데이터를 가져온다.
  const data = ...

  // `props` 키의 값은 `Home` 컴포넌트로 전달될 것이다.
  return {
    props: ...
  }
}
```

기본적으로 `getStaticProps`는 Next.js에게 다음과 같이 말하는 것이다. "이 페이지에는 데이터 종속성이 있어! 그러니 빌드 타임에서 이 페이지를 사전 렌더링할 때 이 문제를 먼저 해결해!"

> **참고**
>
> 개발 모드에서는 `getStaticProps`가 각 요청마다 실행된다.
