# 참조 타입
---
:warning: **심화 학습**

이번 챕터에서는 특정 엣지 케이스(edge case)를 설명하기 위한 심화 내용을 다룬다.

---
복잡한 상황에서 메서드를 호출하면 `this` 값을 잃어버리는 경우가 생긴다.

예시:
```js
let user = {
  name: 'John',
  hi() { alert(this.name); },
  bye() { alert('Bye'); }
};

user.hi(); // John (간단한 호출은 의도한 대로 잘 동작한다)

// name에 따라 user.hi나 user.bye가 호출되게 해보겠다.
(user.name == 'John' ? user.hi : user.bye)(); // TypeError: Cannot read property 'name' of undefined
```
마지막 줄에서 조건부 연산자를 사용해 `user.hi`나 `user.bye` 중 하나가 호출되도록 했다. user의 name이 'John'이므로 `user.hi`가 호출될 것을 예상했다.

그런데 에러가 발생했다. 뒤에 `()`가 있어서 메서드 hi가 즉시 호출될 것이라 예상했는데 원하는 대로 되지 않았다.

에러는 메서드를 호출할 때 `this`에 `undefined`가 할당되었기 때문에 발생했다.

마지막 줄이 다음과 같았다면 에러 없이 잘 작동했을 것이다.
```js
user.hi();
```
그런데 다음 코드에서는 에러가 발생한다.
```js
(user.name == "John" ? user.hi : user.bye)();
```
원인을 알기 위해서는 `obj.method()`를 호출했을 때, 내부에서 어떤 일이 일어나는지 알아야 한다.

## 참조 타입 자세히 알아보기
코드를 유심히 살펴보면 `obj.method()`에는 연산이 두 개 있다는 것을 알 수 있다.
1. 점 `'.'`은 객체 프로퍼티 `obj.method`에 접근한다.
2. 괄호 `()`는 접근한 프로퍼티(메서드)를 실행한다.

그렇다면 첫 번째 연산에서 얻은 `this` 정보가 어떻게 두 번째 연산으로 전달되는 것인지 의문이 생길 수 있다.

두 연산을 별도의 줄에 놓으면 `this` 정보를 잃는 것은 확실하다.
```js
let user = {
  name: 'John',
  hi() { alert(this.name); }
}

// 메서드 접근과 호출을 별도의 줄에서 실행한다.
let hi = user.hi;
hi(); // this가 undefined이기 때문에 에러가 발생한다.
```
`user.hi()`를 의도한 대로 동작시키기 위해 자바스크립트는 속임수를 사용한다. **`'.'`은 함수가 아니라 특별한 참조 타입(Reference Type) 값을 반환한다.**

참조 타입은 명세서에서만 사용되는 타입(specification type)이다. 개발자가 실제로는 사용할 수 없다.

참조 타입에 속하는 값은 `(base, name, strict)`이 조합된 형태를 가진다.
- `base`: 객체
- `name`: 프로퍼티의 이름
- `strict`: 엄격 모드에서 true

`user.hi`로 프로퍼티에 접근하면 함수가 아닌, 참조형(참조 타입) 값을 반환한다. 엄격 모드에서는 다음과 같은 값이 반환된다.
```js
// 참조형 값
(user, 'hi', true)
```
참조형 값에 괄호 `()`를 붙여 호출하면 객체, 객체의 메서드와 연관된 모든 정보를 받는다. 이 정보를 기반으로 `this`(`=user`)가 결정된다.

이렇게 참조 타입은 내부에서 점 `.`연산에서 알아낸 정보를 괄호 `()`로 전달해주는 '중개인' 역할을 한다.

그런데 점 연산 이외의 연산(할당 연산 등)은 참조 타입을 버리고 `user.hi` 값(함수)만 받아 전달한다. 따라서 점 이외의 연산에서는 `this` 정보가 사라진다.

`obj.method()` 같이 점을 사용하거나, `obj[method]()` 같이 대괄호를 사용해 함수를 호출했을 때만 `this` 값이 의도한 대로 전달된다. 이 문제를 해결하는 방법은 [func.bind()](https://github.com/autroshot/studyroom/blob/main/01-javascript/01-%EC%BD%94%EC%96%B4%20%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8/06-%ED%95%A8%EC%88%98%20%EC%8B%AC%ED%99%94%ED%95%99%EC%8A%B5/10-%ED%95%A8%EC%88%98%20%EB%B0%94%EC%9D%B8%EB%94%A9.md#%EB%B0%A9%EB%B2%95-2-bind)를 비롯해 여러 가지가 있다.

## 요약
참조 타입은 자바스크립트 내부에서 사용되는 타입이다.

`.`이나 대괄호를 사용해 객체 프로퍼티인 메서드(`obj.method()`)에 접근하면 프로퍼티 값 자체가 아니라 특별한 '참조 타입' 값이 반한된다. 이 참조 타입 값에는 프로퍼티 값과 프로퍼티가 있는 객체가 담겨있다.

`()`를 사용해 메서드를 호출할 때, 메서드 내에서 사용되는 `this`에 객체를 전달해 줄 수 있는 이유가 이 참조 타입 덕분이다.

그런데 `.`이나 대괄호 이외의 연산에서는 참조 타입이 단순한 프로퍼티 값으로 변해버린다.

이런 내부 동작은 눈에 보이지 않으며 몰라도 별 문제가 되지 않는다. 표현식을 이용해 객체에서 동적으로 메서드를 얻는 경우와 같은 미묘한 경우에만 중요해진다.
