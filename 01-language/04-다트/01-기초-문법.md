# 문법

## 주요 개념

- 변수에 할당할 수 있는 것은 모두 객체이고, 모든 객체는 클래스의 인스턴스이다. 숫자, 함수, `null`은 모두 객체이다. `null`을 제외하면 모든 객체는 `Object` 클래스를 상속한다.
- 다트는 타입에 엄격하지만, 타입을 추론할 수 있기 때문에 타입 주석은 필수가 아니다.
- 널 안정성(null safety)을 활성화하면 변수는 `null`을 포함할 수 없다. 하지만 변수 타입 끝에 물음표(`?`)를 넣어 변수가 `null`이 될 수 있게 만들 수 있다. 만약 어떤 표현식이 `null`로 평가되지 않는다는 것을 알고 있지만 다트가 동의하지 않는다면, `!`를 추가하여 `null`이 아니라고 단언할 수 있다.
- 어떤 타입이든 가능하다고 명시하고 싶다면, 타입으로 `Object?`를 설정하면 된다. 런타임까지 타입 확인을 미뤄야 한다면, 특수한 타입인 `dynamic`을 사용하면 된다.
- 다트는 제네릭 타입을 지원한다.
- 다트는 `main()`과 같은 최상위 함수뿐만 아니라 클래스 또는 객체에 연결된 함수를 지원한다. 중첩 함수도 만들 수 있다.
- 마찬가지로, 다트는 최상위 변수뿐만 아니라 클래스 또는 객체에 연결된 변수를 지원한다.
- 자바와 다르게 다트에는 `public`, `protected`, `private` 같은 키워드가 없다. 식별자가 밑줄(`_`)로 시작한다면 해당 식별자는 해당 라이브러리에서 비공개이다.
- 식별자는 문자 또는 밑줄로 시작할 수 있고, 그 뒤에는 모든 문자와 숫자를 조합할 수 있다.
- 다트에는 런타임 값이 있는 표현식과 런타임 값이 없는 문이 모두 있다.
- 다트의 도구는 경고와 오류라는 두 가지 종류의 문제를 보고할 수 있다. 경고는 코드가 작동하지 않을 수 있다는 표시일 뿐, 프로그램 실행을 방해하지는 않는다. 오류는 컴파일 타임 또는 런타임에 발생할 수 있다. 컴파일 타임 오류는 코드가 전혀 실행되지 못하게 하고, 런타임 오류는 코드가 실행되는 동안 예외가 발생한다.

## 변수

```dart
var name = 'Bob';
```

`name`의 타입은 `String`으로 추론된다.

### 널 안전성

다트 언어에서는 철저한 널 안전성(sound nul safety)이 적용된다.

널 안전성은 널로 설정된 변수에 대한 의도치 않은 접근으로 인해 발생하는 오류를 방지한다. 이러한 오류를 널 역참조 오류라고 한다. 널 역참조 오류는 프로퍼티에 접근하거나 널로 평가되는 표현식에서 메서드를 호출할 때 발생한다.

다트 컴파일러는 컴파일에서 이러한 잠재적 오류를 감지한다.

널 안정성은 다음 세 가지를 도입한다.

- 변수, 매개변수, 기타 관련 컴포넌트에 대한 타입을 지정할 때 널을 허용할지 여부를 제어할 수 있다. 타입 끝에 `?`를 추가하면 된다.
- 변수를 사용하기 전에 변수를 초기화해야 한다. 널이 가능한 변수는 기본값이 널이다. 널이 될 수 없는 변수는 초기값을 반드시 설정해야 한다. 다트에서는 초기화되지 않은 변수를 볼 수 없다.
- 널이 가능한 타입의 표현식에서는 프로퍼티에 접근하거나 메서드를 호출할 수 없다. `hashCode`나 `toString()`과 같이 널이 지원하는 프로퍼티나 메서드인 경우에도 동일한 예외가 적용된다.

철저한 널 안전성은 잠재적인 런타입 오류를 편집에서의 분석 오류로 바꾼다. 널 안정성은 널이 될 수 없는 변수가 다음 중 하나일 때 플래그를 지정한다.

- 널이 아닌 값으로 초기화되지 않았음
- 널이 할당되었음

이 검사를 통해 앱을 배포하기 전에 오류를 고칠 수 있게 된다.

### 기본값

널 안전성을 활성화했다면, `null`이 아닌 변수를 사용하기 전에 값을 초기화해야만 한다.

```dart
int lineCount = 0;
```

지역 변수를 선언과 동시에 초기화할 필요는 없지만, 사용하기 전에 값을 할당해야 한다. 예를 들어, 다음 코드는 `lineCount`가 `print()`로 전달될 때 널이 아님을 감지할 수 있기 때문에 유효하다.

```dart
int lineCount;

if (weLikeToCount) {
  lineCount = countLines();
} else {
  lineCount = 0;
}

print(lineCount);
```

최상위 수준 및 클래스 변수는 느리게 초기화되며, 초기화 코드는 변수가 처음 사용될 때 실행된다.

### 지연 변수

`late` 변경자는 두 가지 쓰임새가 있다.

- 선언 이후에 초기화되는, 널이 아닌 변수를 선언하기
- 변수를 느리게 초기화하기

변수가 사용되기 전에 값이 할당된다고 획신하지만 다트가 동의하지 않는다면, 해당 변수를 `late`로 표시하여 오류를 해결할 수 있다.

### final과 const

`final` 변수는 한 번만 할당할 수 있고, `const` 변수는 컴파일 타임의 상수이다. (`const` 변수는 암시적인 `final` 변수이다.) `final`을 런타임에서의 상수로 이해할 수 있다.

```dart
final name = 'Bob';
```

숫자나 문자열 리터럴, 상수 변수, 상수 숫자에 대한 산술 연산의 결과 같은 것들을 컴파일 타임 상수로 선언한다.

```dart
const bar = 1000000; // 압력의 단위 (dynes/cm2)
const double atm = 1.01325 * bar; // 표준 대기
```

`const` 키워드는 상수 값을 생성하거나 상수 값을 생성하는 생성자를 선언하는 데에도 사용할 수 있다.

```dart
var foo = const [];
final bar = const [];
const baz = []; // `const []`와 동일함
```

`final` 객체는 수정할 수 없지만, 객체의 필드는 수정이 가능하다. 반면에 `const` 객체와 객체의 필드는 **불변**이기 때문에 변경할 수 없다.

## 연산자

`~/`는 정수를 반환하는 나누기이다.

### 동등 연산자

두 객체 x, y가 동일한지 확인하고 싶다면 `==` 연산자를 사용한다. `==` 연산자는 다음과 같이 작동한다.

- x 또는 y가 널일 때, 둘 다 널이라면 `true`를, 하나만 널이라면 `false`를 반환한다.
- y를 인수로 사용하여 x에서 `==` 메서드를 호출한 결과를 반환한다. (`==`와 같은 연산자는 첫 번째 피연산자에서 호출되는 메서드이다.)

### 타입 테스트 연산자

런타임에 타입을 확인할 때 유용하다.

| 연산자 | 의미                                                         |
| ------ | ------------------------------------------------------------ |
| `as`   | 타입캐스트 ([라이브러리 접두사](https://dart-ko.dev/language/libraries#specifying-a-library-prefix)를 지정할 때에도 사용) |
| `is`   | 객체에 해당 타입이 있으면 참                                 |
| `is!`  | 객체에 해당 타입이 없으면 참                                 |

`obj`가 `T`로 특정된 인터페이스의 구현체라면 `obj is T` 의 결과는 참이다. 예를 들어, `obj is Object?`는 항상 참이다.

객체가 특정 타입인 것이 확실해서 해당 타입으로 객체를 캐스팅하려면 `as` 연산자를 사용한다.

```dart
(employee as Person).firstName = 'Bob';
```

만약 어떤 객체가 `T` 타입이라는 것을 확신할 수 없다면, 객체를 사용하기 전에 `is T`로 타입을 확인할 수 있다.

```dart
if (employee is Person) {
  // 타입 검사
  employee.firstName = 'Bob';
}
```

만약 `employee`가 널이거나 `Person`이 아니라면, 첫 번째 예시에서는 예외가 발생하지만, 두 번째 예시에서는 문제가 생기지 않는다.

### 할당 연산자

변수가 널인 경우에만 할당하려면 `??=` 연산자를 사용한다.

```dart
// a에 value를 할당한다.
a = value;
// b가 null이라면 value를 할당하고, 그렇지 않으면 그대로 둔다.
b ??= value;
```

### 조건 표현식

```dart
var visibility = isPublic ? 'public' : 'private';
```

```dart
String playerName(String? name) => name ?? 'Guest';
```

### 캐스케이드 표기법

캐스케이드(`..`, `?..`)는 같은 객체에 대해 일련의 작업을 수행할 수 있게 해준다. 인스턴스 멤버에 접근하거나 인스턴스 메서드를 호출할 수 있다. 이렇게 하면 임시 변수를 만드는 단계를 줄이고 보다 유연한 코드를 작성할 수 있다.

```dart
var paint = Paint()
  ..color = Colors.black
  ..strokeCap = StrokeCap.round
  ..strokeWidth = 5.0;
```

이 예시는 다음 코드와 동일하다.

```dart
var paint = Paint();
paint.color = Colors.black;
paint.strokeCap = StrokeCap.round;
paint.strokeWidth = 5.0;
```

캐스케이드를 사용하는 객체가 널일 수 있다면, 첫 번째 연산에 널 단축 캐스케이드(`?..`)를 사용한다. 널 객체라면 어떤 연산도 시도되지 않는다.

```dart
querySelector('#confirm') // 객체를 얻는다.
  ?..text = 'Confirm' // 객체의 멤버를 사용한다.
  ..classes.add('important')
  ..onClick.listen((e) => window.alert('Confirmed!'))
  ..scrollIntoView();
```

이 예시는 다음 코드와 동일하다.

```dart
var button = querySelector('#confirm');
button?.text = 'Confirm';
button?.classes.add('important');
button?.onClick.listen((e) => window.alert('Confirmed!'));
button?.scrollIntoView();
```

중첩 캐스케이드도 가능하다.

```dart
final addressBook = (AddressBookBuilder()
      ..name = 'jenny'
      ..email = 'jenny@example.com'
      ..phone = (PhoneNumberBuilder()
            ..number = '415-555-0100'
            ..label = 'home')
          .build())
    .build();
```

엄밀히 말하면 캐스케이드의 이중 점 표기법은 연산자가 아니다. 이는 다트 문법의 일부일 뿐이다.

### 전개 연산자

전개 연산자는 컬렉션을 산출하는 표현식을 평가하고, 결과 값의 압축을 푼 다음 다른 컬렉션에 삽입한다.

전개 연산자는 실제로 연산자 표현식이 아니다. `...`/`...?` 구문은 컬렉션 리터럴의 일부이다.

연산자가 아니므로 이 구문에는 연산자 우선 순위가 없다. 사실상 가장 낮은 우선 순위를 가지므로 다음과 같은 표현식이 유효하다.

```dart
[...a + b]
```

## 라이브러리와 가져오기

`import`와 `library` 지시어를 사용하면 모듈식이며 공유 가능한 코드베이스를 만들 수 있다. 라이브러리는 API를 제공할 뿐만 아니라 캡슐화의 단위이기도 하다. 밑줄(`_`)로 시작하는 식별자는 라이브러리 내부에서만 볼 수 있기 때문이다. `library` 지시어를 사용하지 않더라도 모든 다트 파일(과 일부분)은 라이브러리다.

라이브러리는 패키지를 사용하여 배포할 수 있다.

`import`를 사용하여 한 라이브러리의 네임스페이스가 다른 라이브러리의 범위에서 사용되는 방법을 지정할 수 있다.

예를 들어 다트 웹 앱은 다음과 같이 `dart:html` 라이브러리를 많이 사용한다.

```dart
import 'dart:html';
```

`import`에 필요한 유일한 인수는 라이브러리는 지정하는 URI다. 내장 라이브러리의 URI에는 특별한 `dart:` 스키마가 있다. 다른 라이브러리의 경우에는 파일 시스템 경로나 `package:` 스키마를 사용할 수 있다. `package:` 스키마는 펍 도구와 같은 패키지 관리자가 제공하는 라이브러리를 지정한다.

```dart
import 'package:test/test.dart';
```

### 라이브러리 접두사 지정하기

식별자가 충돌하는 두 개의 라이브러리를 가져오는 경우에는, 하나 또는 두 라이브러리 모두에 접두사를 지정할 수 있다.

```dart
import 'package:lib1/lib1.dart';
import 'package:lib2/lib2.dart' as lib2;

// lib1의 Element를 사용한다.
Element element1 = Element();

// lib2의 Element를 사용한다.
lib2.Element element2 = lib2.Element();
```

### 라이브러리의 일부만 가져오기

```dart
// foo만 가져온다.
import 'package:lib1/lib1.dart' show foo;

// foo를 제외한 모든 이름을 가져온다.
import 'package:lib2/lib2.dart' hide foo;
```

[라이브러리 지연 로딩](https://dart.dev/language/libraries#lazily-loading-a-library)은 필요할 때 공부하자.

