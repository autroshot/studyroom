# [03] 코드 품질
코딩 관례(coding practice)에 대해 알아본다.
## 01. Chrome으로 디버깅하기
디버깅(debugging)은 스크립트 내 에러를 검출해 제거하는 일련의 과정을 의미한다. 디버깅 툴은 Chrome 브라우저에서 제공하는 디버깅 툴을 이용한다.
- 중단점(breakpoint): 자바스크립트의 실행이 중단되는 코드 내 지점을 의미한다.
- 조건부 중단점(conditional breakpoint): 표현식을 작성할 수 있으며 해당 표현식이 참인 경우에만 실행을 중지시킬 수 있다. 변수에 특정 값이 할당될 때나 함수의 매개 변수에 특정 값이 들어올 때만 실행을 중단시킬 수 있어 디버깅 시 유용하게 활용할 수 있다.
- 스크립트 내에 `debugger` 명령어를 적어주면 중단점을 설정한 것과 같은 효과를 볼 수 있다.
```javascript
function hello(name) {
  let phrase = `Hello, ${name}!`;

  debugger;  // <-- 여기서 실행이 멈춘다.

  say(phrase);
}
```
- 스크립트 실행이 중단되는 경우는 다음과 같다.
1. 중단점을 만났을 때
2. `debugger`문을 만났을 때
3. 에러가 발생했을 때(개발자 도구가 열려있고 해당 기능이 활성화 되어있는 경우)
- `console.log` 함수를 이용하면 원하는 것을 콘솔에 출력할 수 있다.
- 자세한 디버깅 툴 사용법은 다음 링크를 참조한다.
  - [모던 JavaScript 튜토리얼](https://ko.javascript.info/debugging-chrome)
  - [구글의 공식 매뉴얼](https://developers.google.com/web/tools/chrome-devtools)
<br><br/>
## 02. 코딩 스타일
***개발자는 가능한 한 간결하고 읽기 쉽게 코드를 작성해야 한다.***

몇 가지 추천할만한 규칙은 다음과 같다.  

![code-style](https://user-images.githubusercontent.com/95019875/155277895-ec233dcf-8abc-4869-961f-ef81f41b844a.svg)
  
### 중괄호
여는 중괄호는 새로운 줄이 아닌 같은 줄에 작성하며 여는 중괄호 앞에는 공백이 하나 있어야 한다.
```javascript
if (condition) {
  // 코드 1
  // 코드 2
  // ...코드 n...
}
```
한 줄인 코드도 다음과 같이 중괄호 안에 작성하는 것이 좋다.
```javascript
if (n < 0) {
  alert(`Power ${n} is not supported`);
}
```

### 가로 길이
코드의 가로 길이가 길어진다면 여러 줄로 나눠 작성하는 것이 좋다. 최대 가로 길이는 보통 80자나 120자로 제한한다.
```javascript
// 백틱(`)을 사용하면 문자열을 여러 줄로 쉽게 나눌 수 있습니다.
let str = `
  ECMA International's TC39 is a group of JavaScript developers,
  implementers, academics, and more, collaborating with the community
  to maintain and evolve the definition of JavaScript.
`;
```
```javascript
if (
  id === 123 &&
  moonPhase === 'Waning Gibbous' &&
  zodiacSign === 'Libra'
) {
  letTheSorceryBegin();
}
```

### 들여쓰기
- 가로 들여쓰기: **스페이스 두 개** 혹은 네 개를 사용하거나 탭 키를 이용해 만들 수 있다. 요즘에는 스페이스가 더 우위에 있다. 스페이스를 이용하면 들여쓰기가 좀 더 유연해진다.
```javascript
show(parameters,
     aligned, // 스페이스 다섯 개를 이용해 들여쓰기를 한다.
     one,
     after,
     another
  ) {
  // ...
}
```
- 세로 들여쓰기: 논리 블록 사이에 넣어 코드를 분리해주는 여분의 줄을 넣어주면 코드의 가독성이 좋아진다. 세로 들여쓰기 없이 코드를 아홉 줄 이상 연속해서 쓰는 것은 좋지 않다.
```javascript
function pow(x, n) {
  let result = 1;
  //              <--
  for (let i = 0; i < n; i++) {
    result *= x;
  }
  //              <--
  return result;
}
```

### 세미콜론
모든 구문의 끝에는 세미콜론을 써주는 것이 좋다.

### 중첩 레벨
가능하면 너무 깊은 중첩문은 사용하지 않아야 한다.
- `continue`를 사용해서 중첩문을 줄일 수 있다.
```javascript
for (let i = 0; i < 10; i++) {
  if (cond) {
    ... // <- 중첩 레벨이 하나 더 늘어났다.
  }
}
```
```javascript
for (let i = 0; i < 10; i++) {
  if (!cond) continue;
  ...  // <- 중첩 레벨이 늘어나지 않는다.
}
```
- `if/else`와 return문을 조합해서 중첩문을 줄일 수 있다.
```javascript
function pow(x, n) {
  if (n < 0) {
    alert('"n"은 음수가 될 수 없습니다.');
  } else {
    let result = 1;

    for (let i = 0; i < n; i++) {
      result *= x;
    }

    return result;
  }
}
```
```javascript
function pow(x, n) {
  if (n < 0) {
    alert('"n"은 음수가 될 수 없습니다.');
    return;
  }

  let result = 1;

  for (let i = 0; i < n; i++) {
    result *= x;
  }

  return result;
}
```

### 함수의 위치
함수를 사용하는 코드가 먼저 있고 그 이후에 함수를 선언하는 방식을 선호한다. 사람들은 이 코드가 무엇을 하는지를 생각하며 코드를 읽기 때문에 코드가 먼저 나오는 것이 자연스럽다. 그리고 함수의 이름을 제대로 만들었다면 함수 본문을 읽을 필요도 없을 것이다.
```javascript
// 헬퍼 함수를 사용하는 코드
let elem = createElement();
setHandler(elem);
walkAround();

// --- 헬퍼 함수 ---
function createElement() {
  ...
}

function setHandler(elem) {
  ...
}

function walkAround() {
  ...
}
```

### 스타일 가이드
코딩 스타일 가이드는 **코드를 어떻게 작성할지**에 대한 전반적인 규칙을 담은 문서이다.

추천 스타일 가이드:
- [구글](https://google.github.io/styleguide/jsguide.html)
- [에어비앤비](https://github.com/airbnb/javascript)
- [Idiomatic.JS](https://github.com/rwaldron/idiomatic.js)
- [StandardJS](https://standardjs.com/)

### Linter
Linter를 사용하면 내가 작성한 코드가 스타일 가이드를 준수하고 있는지를 자동으로 확인할 수 있고, 스타일 개선과 관련된 제안도 받을 수 있다.
- [ESLint](http://eslint.org/)
<br><br/>
## 03. 주석
주석(comment)은 어떻게 코드가 동작하는지, 왜 코드가 동작하는지를 설명할 때 쓰인다.

### 좋지 않은 주석
- 코드에서 무슨 일이 일어나는지 적는 주석은 좋지 않다. ***코드가 불분명해서 주석 작성을 해야 한다면 코드를 다시 작성해야 하는 것이다.***
```javascript
// 이 코드는 (...)과 (...)을 수행한다
// A라는 개발자가 이 기능에 대해 알고 있으며...
very;
complex;
code;
```
- 리팩토링 팁
1. 함수 분리하기: 함수 내 코드 일부를 새로운 함수로 만든다.
2. 함수 만들기: 코드가 길게 늘어져 있는 경우 코드 일부를 새로운 함수에 넣는다.

### 좋은 주석
1. 아키텍처를 설명하는 주석: 고차원 수준 컴포넌트 개요, 컴포넌트 간 상호작용에 대한 설명, 상황에 따른 제어 흐름 등을 설명한다. 이런 주석은 조감도 역할을 한다.
2. 함수 용례와 매개변수 정보를 담고 있는 주석: JSDoc을 이용하면 쉽게 작성할 수 있다.
```javascript
/**
 * x를 n번 곱한 수를 반환함
 *
 * @param {number} x 거듭제곱할 숫자
 * @param {number} n 곱할 횟수, 반드시 자연수여야 함
 * @return {number} x의 n 거듭제곱을 반환함
 */
function pow(x, n) {
  ...
}
```
3. 왜 이런 방법으로 문제를 해결했는지를 설명하는 주석: 이전에 했던 실수를 방지하는 안내판 역할을 한다.
4. 미묘한 기능이 있고, 이 기능이 어디에 쓰이는지를 설명하는 주석: 직감에 반하는 미묘한 동작을 수행하는 코드가 있다면 주석을 달아주는 것이 좋다.
<br><br/>
## 04. 닌자 코드
아래 방법들을 사용하면 유지 보수가 어려워져 당신을 해고할 수 없게 된다. 또한 후배 개발자들에게 엄청난 영감도 심어줄 수 있다.
### 코드 짧게 쓰기
가능한 한 코드를 짧게 써서, 당신이 얼마나 똑똑한 사람인지 보여줘야 한다.

### 글자 하나만 사용하기
`a`, `b`, `c` 같은 변수 이름을 사용한다. 그리고 `for`문에서는 변수 `i` 대신 `x`, `y` 같은 생소한 변수 이름을 사용한다.

### 약어 사용하기
당신의 코드를 읽을 수 있을 정도로 직관력이 뛰어난 개발자만이 유지 보수를 할 수 있을 것이다.
- `list` → `lst`
- `userAgent` → `ua`
- `browser` → `brsr`

### 포괄적인 명사 사용하기
변수 이름에 `obj`, `data`, `value`, `item`, `elem` 같이 다양한 개념을 포괄할 수 있는 명사를 사용한다.
- **`data`는 가장 이상적인 변수명이다.** 변수가 실제로 담고 있는 건 데이터이기 때문이다. `value`도 좋은 대안이 될 수 있다.
- **`str`, `num` 같이 자료형과 연관된 변수명을 사용한다.** 이런 변수명을 보고 변수의 의미를 파악하기는 어려운 일이다.
- 더 이상 새로운 변수명이 떠오르지 않을 때는 `data1`, `item2`, `elem5` 처럼 옆에 숫자를 붙여주면 된다.

### 철자가 유사한 단어 사용하기
`date`와 `data` 같이 유사한 철자를 가진 단어를 조합해 사용하면 주의력이 떨어지는 개발자를 걸러낼 수 있다.

### 동의어 사용하기
동의어를 사용해면 당신의 풍부한 어휘력을 은연중에 드러낼 수 있다. 유사한 동작을 수행하는 두 함수에 동의어로 다른 이름을 붙여서 사람들을 헷갈리게 만들 수 있다.
```javascript
function displayMessage(...) {...} // 화면에 메시지를 보여주는 함수이다.
function showName(...) {...} // 화면에 이름을 보여주는 함수이다.
```

### 이름 재사용하기
새로운 값을 저장할 때 기존 변수를 활용하면 불필요한 변수 선언을 최대한 피할 수 있다. 변수에 현재 어떤 값이 들어가 있는지, 값의 유래는 어디인지 쉽게 파악하지 못하게 만들어서 개발자의 직관력과 암기력을 단련시켜준다.

### 재미로 언더스코어 사용하기
\_name이나 \_\_value처럼 변수명 앞에 \_나 \_\_을 붙인다. 언더스코어가 무엇을 의미하는지는 코드 작성자만 아는 것도 좋지만, 더 좋은 방법은 그저 장난으로 붙이거나 의미를 계속 바꿔가면서 언더스코어를 붙이는 것이다.

### 과장 형용사 사용하기
`superElement`, `megaFrame`, `niceItem`처럼 개체 앞에 적절한 형용사를 붙여 해당 개체가 얼마나 멋진지 알려준다.

### 외부 변수 덮어쓰기
개발자는 `user`가 다시 정의되었다는 것을 쉽게 놓치고 함정에 빠질 것이다.
```javascript
let user = authenticateUser();

function render() {
  let user = anotherValue();
  ...
  ...함수 길이가 긺...
  ...
  ... // <-- 개발자는 user와 관련된 이 부분의 코드를 수정해야 한다.
  ...
}
```

### 부작용이 있는 코드 작성하기
함수에 원래 기능을 넘어선 '유용한 기능'을 추가한다. 또는 예상치 않은 결과를 반환하는 것도 한 방법이다. `checkPermission`이라는 함수를 호출했을 때의 반환 값이 `true`나 `false`가 아니라면 좋다. 확인 여부에 추가적인 정보를 엮어 만든 객체를 반환해 당신의 독창성을 뽐낼 수 있다.

### 함수에 다양한 기능 넣기
함수가 할 수 있는 동작을 함수 이름에 한정 짓지 말고 함수의 기능을 최대한 확장한다. 함수 이름에서 유추할 수 없을 만한 기능을 추가할수록 더 좋다. 함수 하나에 여러 기능을 욱여넣으면 코드 재사용도 방지할 수 있다.
<br><br/>
## 05. 테스트 자동화와 Mocha
### 테스트는 왜 해야 하는가?
코드를 수동으로 재실행하면서 테스트를 하면 무언가를 놓치기 쉬우므로 테스트를 자동화할 필요가 있다. 테스팅 자동화는 테스트 코드가 실제 동작에 관여하는 코드와 별개로 작성되었을 때 가능하다. 테스트 코드를 이용하면 함수를 다양한 조건에서 실행해 볼 수 있는데, 이때 실행 결과와 기대 결과를 비교할 수 있습니다.

### Behavior Driven Development(BDD)
BDD는 테스트(test), 문서(documentation), 예시(example)를 한데 모아놓은 개념이다.

### 명세서
본격적으로 코드를 작성하기 전에 먼저 해야 할 것이 있다. 코드가 무슨 일을 하는지 상상한 후 이를 자연어로 표현해야 한다. 이때 만들어지는 산출물을 BDD에서는 명세서(specification) 또는 짧게 줄여서 스펙(spec)이라고 부른다.
```javascript
describe("pow", function() {
  it("주어진 숫자의 n 제곱", function() {
    assert.equal(pow(2, 3), 8);
  });
});
```
스펙은 다음과 같이 세 가지로 구성된다.
1. `describe("title", function() { ... })`  
: 구현하고자 하는 기능에 대한 설명이 들어가며 `it` 블록을 한데 모아주는 역할도 한다.

2. `it("유스 케이스 설명", function() { ... })`  
: `it`의 첫 번째 인수에는 특정 유스 케이스에 대한 설명이 들어갑니다. 이 설명은 누구나 읽을 수 있고 이해할 수 있는 자연어로 적어준다. 두 번째 인수에는 유스 케이스 테스트 함수가 들어간다.

3. `assert.equal(value1, value2)`  
: 기능을 제대로 구현했다면 it 블록 내의 코드가 에러 없이 실행된다. assert.equal은 인수끼리 동등 비교했을 때 다르다고 판단되면 에러를 반환한다.

### 개발 순서
1. 명세서 초안을 작성한다. 초안에는 기본적인 테스트도 들어간다.
2. 명세서 초안을 보고 코드를 작성한다.
3. 코드가 작동하는지 확인하기 위해 Mocha라 불리는 테스트 프레임워크를 사용해 명세서를 실행한다. 이때, 코드가 잘못 작성되었다면 에러가 출력된다. 개발자는 테스트를 모두 통과해 에러가 더는 출력되지 않을 때까지 코드를 수정한다.
4. 이제 모든 테스트를 통과하는 코드 초안이 완성되었다.
5. 명세서에 지금까지는 고려하지 않았던 유스케이스 몇 가지를 추가한다. 테스트가 실패하기 시작할 것이다.
6. 세 번째 단계로 돌아가 테스트를 모두 통과할 때까지 코드를 수정한다.
7. 기능이 완성될 때까지 3~6단계를 반복한다.

### 스펙 실행하기
테스트에 사용되는 라이브러리는 아래 세 가지다.
- [Mocha](http://mochajs.org/): 핵심 테스트 프레임워크로, `describe`, `it`과 같은 테스팅 함수와 테스트 실행 관련 주요 함수를 제공한다.
- [Chai](http://chaijs.com): 다양한 assertion을 제공해 주는 라이브러리다.
- [Sinon](http://sinonjs.org/): 함수의 정보를 얻을 때 사용되는 라이브러리로 내장 함수 등을 모방한다. 다음 예시에서는 사용하지 않는다.

```javascript
<!DOCTYPE html>
<html>
<head>
  <!-- 결과 출력에 사용되는 mocha css를 불러온다. -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mocha/3.2.0/mocha.css">
  <!-- Mocha 프레임워크 코드를 불러온다. -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mocha/3.2.0/mocha.js"></script>
  <script>
    mocha.setup('bdd'); // 기본 셋업
  </script>
  <!-- chai를 불러온다. -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chai/3.5.0/chai.js"></script>
  <script>
    // chai의 다양한 기능 중, assert를 전역에 선언한다.
    let assert = chai.assert;
  </script>
</head>
<body>
  <script>
    function pow(x, n) {
      /* 작동 코드를 여기에 작성한다. */
    }
  </script>

  <!-- 테스트(describe, it...)가 있는 스크립트를 불러온다. -->
  <script src="test.js"></script>

  <!-- 테스트 결과를 id가 "mocha"인 요소에 출력하도록 한다.-->
  <div id="mocha"></div>

  <!-- 테스트를 실행한다. -->
  <script>
    mocha.run();
  </script>
</body>
</html>
```
